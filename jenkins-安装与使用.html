<!DOCTYPE html>
<html lang="zh">

<head>
    <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta http-equiv="X-UA-Compatible" content="ie=edge">
<link media="all" rel="stylesheet" href="./css/style.css">

<script src="./js/style.js"></script>



    <title>Jenkins 安装与使用 - 打工人日志</title>
</head>

<body>
    <div class="header-box">
    <img src="https://www.jobcher.com/images/logo.webp" id="logo" alt="logo" class="logo">
    <h1><a href="https://www.jobcher.com">打工人日志</a></h1>
</div>
<nav class="nav">
    <ul>
        
            <li>
                <a href="./">首页</a>
                
            </li>
        
            <li>
                <a href="https://nav.jobcher.com/">导航</a>
                
            </li>
        
            <li>
                <a href="./%E5%85%B3%E4%BA%8E%E6%88%91.html">关于</a>
                
            </li>
        
    </ul>
</nav>
    <div id="post" class="post">
        <header>
            <h2 class="post-title">Jenkins 安装与使用</h2>
            
        </header>
        <article class="article">
                <div class="single-content">
                    <h1 id="jenkins-安装与使用">Jenkins 安装与使用</h1>
<p>代码在本地修改&mdash;-》提交到远程 gitlab&mdash;-》触发 jenkins 整个自动化构建流程（打包，测试，发布，部署）</p>
<h2 id="安装-docker">安装 docker</h2>
<p><a href="https://www.jobcher.com/docker/">安装 docker</a></p>
<h2 id="docker-安装-jenkins">docker 安装 jenkins</h2>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>docker run <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  -u root <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  -d <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  -p 8080:8080 <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  -p 50000:50000 <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  -v jenkins-data:/var/jenkins_home <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  -v /etc/localtime:/etc/localtime:ro <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  -v /var/run/docker.sock:/var/run/docker.sock <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  --restart<span style="color:#f92672">=</span>always <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  jenkinsci/blueocean
</span></span></code></pre></div><h2 id="访问">访问</h2>
<p>http://localhost:8080</p>
<p>显示初始密码</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>docker exec -ti &lt;容器名称&gt; sh
</span></span><span style="display:flex;"><span>cat /var/jenkins_home/secrets/initialAdminPassword
</span></span></code></pre></div><h2 id="工作流程">工作流程</h2>
<ol>
<li>先定义一个流水线项目，指定项目的 git 位置</li>
<li>git 位置自动拉取代码</li>
<li>解析拉取代码里面的 Jenkinsfile 文件</li>
<li>按照 Jenkinsfile 指定的流水线开始加工项目</li>
</ol>
<h2 id="jenkinsfile-语法">Jenkinsfile 语法</h2>
<p>基础语法,在仓库创建一个 <code>Jenkinsfile</code> 文件</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">pipeline</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#960050;background-color:#1e0010">/*</span> <span style="color:#960050;background-color:#1e0010">全部的CICD流程都在这里定义</span> <span style="color:#960050;background-color:#1e0010">*/</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">//任意代理可用就可以执行
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#960050;background-color:#1e0010">agent</span> <span style="color:#960050;background-color:#1e0010">any</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">//定义流水线的加工流程
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#960050;background-color:#1e0010">stages</span> <span style="color:#960050;background-color:#1e0010">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#960050;background-color:#1e0010">/*</span> <span style="color:#960050;background-color:#1e0010">流水线的所有阶段</span>
</span></span><span style="display:flex;"><span>            <span style="color:#960050;background-color:#1e0010">1.编译</span> <span style="color:#f92672">&#34;常量&#34;</span><span style="color:#960050;background-color:#1e0010">&#39;变量&#39;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#ae81ff">2</span><span style="color:#960050;background-color:#1e0010">.测试</span>
</span></span><span style="display:flex;"><span>            <span style="color:#ae81ff">3</span><span style="color:#960050;background-color:#1e0010">.打包</span>
</span></span><span style="display:flex;"><span>            <span style="color:#ae81ff">4</span><span style="color:#960050;background-color:#1e0010">.部署</span>
</span></span><span style="display:flex;"><span>        <span style="color:#960050;background-color:#1e0010">*/</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#960050;background-color:#1e0010">stage(&#39;代码编译&#39;)</span>{
</span></span><span style="display:flex;"><span>            <span style="color:#960050;background-color:#1e0010">steps</span> <span style="color:#960050;background-color:#1e0010">{</span>
</span></span><span style="display:flex;"><span>                <span style="color:#75715e">//要做的所有事情
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>                <span style="color:#960050;background-color:#1e0010">echo</span> <span style="color:#f92672">&#34;编译……&#34;</span>
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#960050;background-color:#1e0010">stage(&#39;代码测试&#39;)</span>{
</span></span><span style="display:flex;"><span>            <span style="color:#960050;background-color:#1e0010">steps</span> <span style="color:#960050;background-color:#1e0010">{</span>
</span></span><span style="display:flex;"><span>                <span style="color:#75715e">//要做的所有事情
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>                <span style="color:#960050;background-color:#1e0010">echo</span> <span style="color:#f92672">&#34;测试……&#34;</span>
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>        <span style="color:#960050;background-color:#1e0010">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#960050;background-color:#1e0010">stage(&#39;打包&#39;)</span>{
</span></span><span style="display:flex;"><span>            <span style="color:#960050;background-color:#1e0010">steps</span> <span style="color:#960050;background-color:#1e0010">{</span>
</span></span><span style="display:flex;"><span>                <span style="color:#75715e">//要做的所有事情
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>                <span style="color:#960050;background-color:#1e0010">echo</span> <span style="color:#f92672">&#34;打包……&#34;</span>
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>        <span style="color:#960050;background-color:#1e0010">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#960050;background-color:#1e0010">stage(&#39;部署&#39;)</span>{
</span></span><span style="display:flex;"><span>            <span style="color:#960050;background-color:#1e0010">steps</span> <span style="color:#960050;background-color:#1e0010">{</span>
</span></span><span style="display:flex;"><span>                <span style="color:#75715e">//要做的所有事情
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>                <span style="color:#960050;background-color:#1e0010">echo</span> <span style="color:#f92672">&#34;部署……&#34;</span>
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>        <span style="color:#960050;background-color:#1e0010">}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#960050;background-color:#1e0010">}</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">}</span>
</span></span></code></pre></div><h2 id="构建远程触发">构建远程触发</h2>
<ol>
<li>
<p>在 jenkins 上选择:项目-&gt;配置-&gt;构建触发器-&gt;勾选触发远程构建<br>
<img src="./images/jenkins.png" alt="远程触发"></p>
</li>
<li>
<p>新疆 gitlab 账户，登录新用户并天剑 token 令牌<br>
<img src="./images/jenkins1.png" alt="远程触发"><br>
<img src="./images/jenkins2.png" alt="远程触发"></p>
</li>
<li>
<p>找到 gitlab 设置-&gt;webhook<br>
<img src="./images/jenkins3.png" alt="远程触发"><br>
网站格式</p>
</li>
</ol>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>http://&lt;USER&gt;:&lt;TOKENAPI&gt;@&lt;JENKINS-URL&gt;/job/test-blog-demo/build?token=&lt;TOKEN&gt;
</span></span></code></pre></div>
                </div>
            <br />
        <div>
                
                <a href="https://www.jobcher.com/%E6%B8%85%E7%90%86docker%E7%9A%84containerimage%E4%B8%8Evolume.html" class="prev">前一页</a>
                
                
                <a href="https://www.jobcher.com/navicat-%E6%9F%A5%E7%9C%8B%E5%AF%BC%E5%87%BA%E8%BF%9E%E6%8E%A5%E7%9A%84%E5%AF%86%E7%A0%81-navicat%E6%9F%A5%E7%9C%8B%E5%AF%86%E7%A0%81%E6%96%B9%E6%A1%88.html" class="next">后一页</a>
                
            </div>
        </article>
    </div>

    <nav class="footer-nav">
        <ul>
            
            <li><a href="./%E5%85%B3%E4%BA%8E%E6%88%91.html">关于我们</a></li>
            
            <li><a href="./">网站首页</a></li>
            
            <li><a href=""></a></li>
            
        </ul>
    </nav>
    <footer class="footer">
    <span style="color: aliceblue;">© 2019-2023 by jobcher</span>
</footer>
</body>

</html>