<!DOCTYPE html>
<html lang="zh">

<head>
    <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta http-equiv="X-UA-Compatible" content="ie=edge">
<link media="all" rel="stylesheet" href="./css/style.css">

<script src="./js/style.js"></script>



    <title>skywalking APM 监控 - 打工人日志</title>
</head>

<body>
    <div class="header-box">
    <img src="https://www.jobcher.com/images/logo.webp" id="logo" alt="logo" class="logo">
    <h1><a href="https://www.jobcher.com">打工人日志</a></h1>
</div>
<nav class="nav">
    <ul>
        
            <li>
                <a href="./">首页</a>
                
            </li>
        
            <li>
                <a href="https://nav.jobcher.com/">导航</a>
                
            </li>
        
            <li>
                <a href="./%E5%85%B3%E4%BA%8E%E6%88%91.html">关于</a>
                
            </li>
        
    </ul>
</nav>
    <div id="post" class="post">
        <header>
            <h2 class="post-title">skywalking APM 监控</h2>
            
        </header>
        <article class="article">
                <div class="single-content">
                    <h1 id="skywalking">skywalking</h1>
<p>基于 OpenTracing 规范，专门为微服务架构以及云原生服务。</p>
<h2 id="apm-监控">APM 监控</h2>
<p>一个基于微服务架构的电商系统<br>
<!-- raw HTML omitted --><br>
<code>APM </code>(Application Performance Management) 即应用性能管理，属于 IT 运维管理（ITOM)范畴.<br>
分为一下三个方面：</p>
<ul>
<li>Logging<br>
服务在处理某个请求时打印的错误日志，可以将这些日志信息记录到<code>Elasticsearch</code>或是其他存储中。通过 Kibana 或是其他工具来分析这些日志了解服务的行为和状态，大多数情况下。日志记录的数据很分散，并且相互独立。例如错误日志，请求处理过程中关键步骤的日志等等。</li>
<li>Metrics<br>
<code>Metric</code>是可以聚合的，例如为电商系统中每个 HTTP 接口添加一个计数器，计算每个接口的 QPS，可以通过简单的加和计算得到系统的总负载情况。</li>
<li>Tracing<br>
在微服务架构系统中一请求会经过很多服务处理，调用链路会非常长，要确定中间哪个服务出现异常是非常麻烦的事情，通过分布式链路追踪，运维人员就可以构建一个请求的视图。视图上战术了一个请求从进入系统开始到返回响应的整个流程。</li>
</ul>
<blockquote>
<p><code>系统交互图</code><br>
<!-- raw HTML omitted --></p>
</blockquote>
<blockquote>
<p><code>系统加载图</code> &gt; <!-- raw HTML omitted --></p>
</blockquote>
<h2 id="目前流行的apm监控">目前流行的<code>APM监控</code></h2>
<ul>
<li>Zipkin
<ul>
<li>对 web.xml 进行修改，代码侵入</li>
<li>twitter 开源</li>
</ul>
</li>
<li>Cat
<ul>
<li>支持 Java、C/C++、Node.Js、Python、go</li>
<li>代码侵入，埋点</li>
<li>美团开源</li>
</ul>
</li>
<li>Pinpoint
<ul>
<li>基于字节码注入技术，代码无侵入</li>
<li>韩国公司开发，社区交流滞后</li>
<li>只支持 hbase</li>
<li>颗粒度更细</li>
</ul>
</li>
<li>Skywalking<br>
观测性分析平台
<ul>
<li>基于字节码注入技术，代码无侵入</li>
<li>服务、服务实例、端点指标分析</li>
<li>服务拓扑图分析</li>
<li>服务、服务实例和端点（Endpont）SLA 分析</li>
<li>支持 es，h2,mysql,TiDb,sharding-sphere</li>
</ul>
</li>
</ul>
<h1 id="skywalking-整体框架">skywalking 整体框架</h1>
<!-- raw HTML omitted -->
<ul>
<li>上部分 <code>Agent</code> ：负责从应用中，收集链路信息，发送给 SkyWalking OAP 服务器。目前支持 SkyWalking、Zikpin、Jaeger 等提供的 Tracing 数据信息。而我们目前采用的是，SkyWalking Agent 收集 SkyWalking Tracing 数据，传递给服务器。</li>
<li>下部分 <code>SkyWalking OAP</code> ：负责接收 Agent 发送的 Tracing 数据信息，然后进行分析(Analysis Core) ，存储到外部存储器( Storage )，最终提供查询( Query )功能。</li>
<li>右部分 <code>Storage</code> ：Tracing 数据存储。目前支持 ES、MySQL、Sharding Sphere、TiDB、H2 多种存储器。而我们目前采用的是 ES ，主要考虑是 SkyWalking 开发团队自己的生产环境采用 ES 为主。</li>
<li>左部分 <code>SkyWalking UI</code> ：负责提供控台，查看链路等等。</li>
</ul>
<h2 id="skywalking-配置">skywalking 配置</h2>
<h2 id="使用-docker-compose-安装">使用 docker-compose 安装</h2>
<p>使用 mysql 作为存储<br>
下载 <code>mysql-connector-java-8.0.30.jar</code></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>mkdir ./libs/
</span></span><span style="display:flex;"><span>mv mysql-connector-java-8.0.30.jar ./libs/
</span></span></code></pre></div><p>创建带 mysql 驱动的基础镜像</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-Dockerfile" data-lang="Dockerfile"><span style="display:flex;"><span><span style="color:#66d9ef">FROM</span><span style="color:#e6db74"> apache/skywalking-oap-server:9.1.0</span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#66d9ef">LABEL</span> maintainer<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;nb@nbtyfood.com&#34;</span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#66d9ef">COPY</span> ./libs/* /skywalking/oap-libs<span style="color:#960050;background-color:#1e0010">
</span></span></span></code></pre></div><p>上传 dockerhub 或者自己的镜像仓库，这里我是上传到自己的仓库</p>
<ol>
<li>创建镜像
<blockquote>
<p>docker build -t skywalking-mysql-server:v1.0 .</p>
</blockquote>
</li>
<li>打 tag，选择上传位置
<blockquote>
<p>docker tag skywalking-mysql-server:v1.0 &lt;仓库地址&gt;/blog/skywalking-mysql-server:v1.0</p>
</blockquote>
</li>
<li>上传镜像
<blockquote>
<p>docker push &lt;仓库地址&gt;/blog/skywalking-mysql-server:v1.0</p>
</blockquote>
</li>
</ol>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yml" data-lang="yml"><span style="display:flex;"><span><span style="color:#f92672">version</span>: <span style="color:#e6db74">&#34;3&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">services</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">skywalking-oap-server</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">image</span>: <span style="color:#e6db74">&#34;hub.docker.com/jobcher/skywalking-mysql-server:v1.0&#34;</span> <span style="color:#75715e">#docker iamge 地址</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">container_name</span>: <span style="color:#e6db74">&#34;oap-server&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">restart</span>: <span style="color:#e6db74">&#34;always&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">environment</span>:
</span></span><span style="display:flex;"><span>      - <span style="color:#ae81ff">SW_STORAGE=mysql</span>
</span></span><span style="display:flex;"><span>      - <span style="color:#ae81ff">SW_JDBC_URL=&#34;jdbc:mysql://10.12.12.4:3306/sk&#34;</span>
</span></span><span style="display:flex;"><span>      - <span style="color:#ae81ff">SW_DATA_SOURCE_USER=user</span> <span style="color:#75715e"># mysql用户名</span>
</span></span><span style="display:flex;"><span>      - <span style="color:#ae81ff">SW_DATA_SOURCE_PASSWORD=password</span> <span style="color:#75715e"># mysql密码</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">ports</span>:
</span></span><span style="display:flex;"><span>      - <span style="color:#e6db74">&#34;10.12.12.16:12800:12800&#34;</span>
</span></span><span style="display:flex;"><span>      - <span style="color:#e6db74">&#34;10.12.12.16:1234:1234&#34;</span>
</span></span><span style="display:flex;"><span>      - <span style="color:#e6db74">&#34;10.12.12.16:11800:11800&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">skywalking-oap-ui</span>: <span style="color:#75715e">#UI界面</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">image</span>: <span style="color:#e6db74">&#34;apache/skywalking-ui:9.1.0&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">container_name</span>: <span style="color:#e6db74">&#34;oap-ui&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">restart</span>: <span style="color:#e6db74">&#34;always&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">environment</span>:
</span></span><span style="display:flex;"><span>      - <span style="color:#ae81ff">SW_OAP_ADDRESS=http://10.12.12.16:12800</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">ports</span>:
</span></span><span style="display:flex;"><span>      - <span style="color:#e6db74">&#34;8180:8080&#34;</span>
</span></span></code></pre></div>
                </div>
            <br />
        <div>
                
                <a href="https://www.jobcher.com/argo-cd-%E5%AE%89%E8%A3%85%E5%92%8C%E9%83%A8%E7%BD%B2.html" class="prev">前一页</a>
                
                
                <a href="https://www.jobcher.com/systemd-%E5%AE%88%E6%8A%A4%E5%91%BD%E4%BB%A4.html" class="next">后一页</a>
                
            </div>
        </article>
    </div>

    <nav class="footer-nav">
        <ul>
            
            <li><a href="./%E5%85%B3%E4%BA%8E%E6%88%91.html">关于我们</a></li>
            
            <li><a href="./">网站首页</a></li>
            
            <li><a href=""></a></li>
            
        </ul>
    </nav>
    <footer class="footer">
    <span style="color: aliceblue;">© 2019-2023 by jobcher</span>
</footer>
</body>

</html>