<!DOCTYPE html>
<html lang="zh">

<head>
    <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta http-equiv="X-UA-Compatible" content="ie=edge">
<link media="all" rel="stylesheet" href="./css/style.css">
<link media="all" rel="stylesheet" href="./css/search.css">

<script src="./js/style.js"></script>



    <title>Kubernetes — 基于K8S搭建Ceph分布式存储 - 打工人日志</title>
</head>

<body>
    <div class="header-box">
    <img src="https://www.jobcher.com/images/logo.webp" id="logo" alt="logo" class="logo">
    <h1><a href="https://www.jobcher.com">打工人日志</a></h1>
</div>
<nav class="nav">
    <ul>
        
            <li>
                <a href="./">首页</a>
                
            </li>
        
            <li>
                <a href="https://test.jobcher.com/">日报</a>
                
            </li>
        
            <li>
                <a href="https://nav.jobcher.com/">导航</a>
                
            </li>
        
            <li>
                <a href="./%E5%85%B3%E4%BA%8E%E6%88%91.html">关于</a>
                
            </li>
        
    </ul>
</nav>
    <div id="post" class="post">
        <header>
            <h2 class="post-title">Kubernetes — 基于K8S搭建Ceph分布式存储</h2>
            
        </header>
        <article class="article">
                <div class="single-content">
                    <h1 id="基于-k8s-搭建-ceph-分布式存储">基于 K8S 搭建 Ceph 分布式存储</h1>
<h2 id="前提">前提</h2>
<ul>
<li>正常运行的多节点 K8S 集群，可以是两个节点也可以是更多。</li>
<li>每一个节点需要一个<code>没有被分区</code>的<code>硬盘</code>，最好大小一致不然会浪费。
没错其实就是一个要求，必须有集群才能进行容器管理，必须有硬盘才能做存储这些都是基础。</li>
</ul>
<h2 id="添加硬盘">添加硬盘</h2>
<table>
<thead>
<tr>
<th style="text-align:left">主机</th>
<th style="text-align:left">IP</th>
<th style="text-align:left">磁盘</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">master01</td>
<td style="text-align:left">10.12.12.51</td>
<td style="text-align:left">SATA 20G</td>
</tr>
<tr>
<td style="text-align:left">master02</td>
<td style="text-align:left">10.12.12.52</td>
<td style="text-align:left">SATA 20G</td>
</tr>
<tr>
<td style="text-align:left">master03</td>
<td style="text-align:left">10.12.12.53</td>
<td style="text-align:left">SATA 20G</td>
</tr>
<tr>
<td style="text-align:left">worker01</td>
<td style="text-align:left">10.12.12.54</td>
<td style="text-align:left">SATA 20G</td>
</tr>
<tr>
<td style="text-align:left">worker02</td>
<td style="text-align:left">10.12.12.55</td>
<td style="text-align:left">SATA 20G</td>
</tr>
</tbody>
</table>
<p><img src="./images/Ceph1.png" alt="ceph1"></p>
<blockquote>
<p>在 5 个节点都加 20g 存储</p>
</blockquote>
<h3 id="重启-k8s-节点">重启 k8s 节点</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>kubectl cordon &lt;节点&gt;
</span></span><span style="display:flex;"><span>kubectl drain &lt;节点&gt; --ignore-daemonsets --delete-emptydir-data
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 虚拟机重启后</span>
</span></span><span style="display:flex;"><span>kubectl uncordon &lt;节点&gt;
</span></span></code></pre></div><h3 id="查看新增存储">查看新增存储</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>fdisk -l
</span></span></code></pre></div><blockquote>
<p>看到新增 20g 存储,不要格式化分区硬盘！！！</p>
</blockquote>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>Disk /dev/sdb: <span style="color:#ae81ff">20</span> GiB, <span style="color:#ae81ff">21474836480</span> bytes, <span style="color:#ae81ff">41943040</span> sectors
</span></span><span style="display:flex;"><span>Disk model: QEMU HARDDISK
</span></span><span style="display:flex;"><span>Units: sectors of <span style="color:#ae81ff">1</span> * 512 <span style="color:#f92672">=</span> <span style="color:#ae81ff">512</span> bytes
</span></span><span style="display:flex;"><span>Sector size <span style="color:#f92672">(</span>logical/physical<span style="color:#f92672">)</span>: <span style="color:#ae81ff">512</span> bytes / <span style="color:#ae81ff">512</span> bytes
</span></span><span style="display:flex;"><span>I/O size <span style="color:#f92672">(</span>minimum/optimal<span style="color:#f92672">)</span>: <span style="color:#ae81ff">512</span> bytes / <span style="color:#ae81ff">512</span> bytes
</span></span></code></pre></div><h2 id="rook-自动创建">ROOK 自动创建</h2>
<p><img src="./images/rook.png" alt="rook"></p>
<ul>
<li>Rook 是一个开源的<code>cloud-native storage</code>编排, 提供平台和框架；为各种存储解决方案提供平台、框架和支持，以便与云原生环境本地集成。</li>
<li>Rook 将存储软件转变为自我管理、自我扩展和自我修复的存储服务，它通过自动化部署、引导、配置、置备、扩展、升级、迁移、灾难恢复、监控和资源管理来实现此目的。</li>
<li>Rook 使用底层云本机容器管理、调度和编排平台提供的工具来实现它自身的功能。</li>
<li>Rook 目前支持<code>Ceph</code>、<code>NFS</code>、<code>Minio Object Store</code>和<code>CockroachDB</code>。</li>
<li>Rook 使用<code>Kubernetes</code>原语使<code>Ceph存储系统</code>能够在<code>Kubernetes</code>上运行。</li>
</ul>
<h3 id="下载">下载</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>git clone https://github.com/rook/rook.git
</span></span></code></pre></div><h3 id="安装">安装</h3>

                </div>
            <br />
        <div>
                
                <a href="https://www.jobcher.com/kubernetes-rook%E4%BA%91%E5%AD%98%E5%82%A8%E4%BB%8B%E7%BB%8D%E5%92%8C%E9%83%A8%E7%BD%B2.html" class="prev">前一页</a>
                
                
                <a href="https://www.jobcher.com/kubernetes-%E6%8E%A2%E9%92%88%E5%92%8C%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F.html" class="next">后一页</a>
                
            </div>
        </article>
    </div>

    <nav class="footer-nav">
        <ul>
            
            <li><a href="./%E5%85%B3%E4%BA%8E%E6%88%91.html">关于我们</a></li>
            
            <li><a href="./">网站首页</a></li>
            
            <li><a href=""></a></li>
            
        </ul>
    </nav>
    <footer class="footer">
    <span style="color: aliceblue;">© 2019-2023 by jobcher</span>
</footer>
</body>

</html>