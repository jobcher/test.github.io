<!DOCTYPE html>
<html lang="zh">

<head>
    <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta http-equiv="X-UA-Compatible" content="ie=edge">
<link media="all" rel="stylesheet" href="./css/style.css">

<script src="./js/style.js"></script>



    <title>nginx 汇总 - 打工人日志</title>
</head>

<body>
    <div class="header-box">
    <img src="https://test.jobcher.com/images/logo.webp" id="logo" alt="logo" class="logo">
    <h1><a href="https://test.jobcher.com">打工人日志</a></h1>
</div>
<nav class="nav">
    <ul>
        
            <li>
                <a href="./">首页</a>
                
            </li>
        
            <li>
                <a href="https://nav.jobcher.com/">导航</a>
                
            </li>
        
            <li>
                <a href="./posts/about">关于</a>
                
            </li>
        
    </ul>
</nav>
    <div id="post" class="post">
        <header>
            <h2 class="post-title">nginx 汇总</h2>
            
        </header>
        <article class="article">
                <div class="single-content">
                    <h1 id="nginx-汇总">nginx 汇总</h1>
<p>各类 nginx 问题汇总</p>
<h2 id="安装-nginx">安装 nginx</h2>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>    <span style="color:#75715e">#centos</span>
</span></span><span style="display:flex;"><span>    yum install nginx
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">#ubuntu</span>
</span></span><span style="display:flex;"><span>    apt install nginx
</span></span></code></pre></div><h2 id="http-代理">http 代理</h2>
<h3 id="正向代理">正向代理</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>    server <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>        listen       80;
</span></span><span style="display:flex;"><span>        server_name  www.nbtyfood.com;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        location / <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>            proxy_pass http://127.0.0.1:8080;
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">}</span>
</span></span></code></pre></div><h3 id="反向代理">反向代理</h3>
<h2 id="负载均衡">负载均衡</h2>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>    upstream mysvr <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>    server 192.168.10.121:3333;
</span></span><span style="display:flex;"><span>    server 192.168.10.122:3333;
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>    server <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>        ....
</span></span><span style="display:flex;"><span>        location  ~*^.+$ <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>            proxy_pass  http://mysvr;  <span style="color:#75715e">#请求转向mysvr 定义的服务器列表</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">}</span>
</span></span></code></pre></div><ol>
<li>热备<br>
如果你有 2 台服务器，当一台服务器发生事故时，才启用第二台服务器给提供服务。服务器处理请求的顺序：AAAAAA 突然 A 挂啦，BBBBBBBBBBBBBB&hellip;..</li>
</ol>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>    upstream mysvr <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>    server 127.0.0.1:7878;
</span></span><span style="display:flex;"><span>    server 192.168.10.121:3333 backup;  <span style="color:#75715e">#热备</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">}</span>
</span></span></code></pre></div><ol start="2">
<li>轮询<br>
nginx 默认就是轮询其权重都默认为 1，服务器处理请求的顺序：ABABABABAB&hellip;.</li>
</ol>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>    upstream mysvr <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>    server 127.0.0.1:7878;
</span></span><span style="display:flex;"><span>    server 192.168.10.121:3333;
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">}</span>
</span></span></code></pre></div><ol start="3">
<li>加权轮询<br>
跟据配置的权重的大小而分发给不同服务器不同数量的请求。如果不设置，则默认为 1。下面服务器的请求顺序为：ABBABBABBABBABB&hellip;.</li>
</ol>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>    upstream mysvr <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>    server 127.0.0.1:7878 weight<span style="color:#f92672">=</span>1;w
</span></span><span style="display:flex;"><span>    server 192.168.10.121:3333 weight<span style="color:#f92672">=</span>2;
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">}</span>
</span></span></code></pre></div><ol start="4">
<li>ip_hash
nginx 会让相同的客户端 ip 请求相同的服务器。</li>
</ol>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>    upstream mysvr <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>    server 127.0.0.1:7878;
</span></span><span style="display:flex;"><span>    server 192.168.10.121:3333;
</span></span><span style="display:flex;"><span>    ip_hash;
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">}</span>
</span></span></code></pre></div><h2 id="web-缓存">web 缓存</h2>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>    location /images/ <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>    proxy_cache my_cache;
</span></span><span style="display:flex;"><span>    proxy_ignore_headers Cache-Control;
</span></span><span style="display:flex;"><span>    proxy_cache_valid any 30m;
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># ...</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span></code></pre></div><h2 id="重定向">重定向</h2>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>    rewrite ^/<span style="color:#f92672">(</span>.*<span style="color:#f92672">)</span> http://www.nbtyfood.com/$1 permanent;
</span></span></code></pre></div>
                </div>
            <br />
        <div>
                
                <a href="https://test.jobcher.com/2021%E5%B9%B4%E7%AC%AC50%E5%91%A8%E8%AE%B0.html" class="prev">前一页</a>
                
                
                <a href="https://test.jobcher.com/tcp/ip%E8%AF%A6%E8%A7%A3.html" class="next">后一页</a>
                
            </div>
        </article>
    </div>

    <nav class="footer-nav">
        <ul>
            
            <li><a href="./posts/about">关于我们</a></li>
            
            <li><a href="./">网站首页</a></li>
            
            <li><a href=""></a></li>
            
        </ul>
    </nav>
    <footer class="footer">
    <span style="color: aliceblue;">© 2019-2023 by jobcher</span>
</footer>
</body>

</html>