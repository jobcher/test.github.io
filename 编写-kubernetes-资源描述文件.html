<!DOCTYPE html>
<html lang="zh">

<head>
    <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta http-equiv="X-UA-Compatible" content="ie=edge">
<link media="all" rel="stylesheet" href="./css/style.css">
<link media="all" rel="stylesheet" href="./css/search.css">

<script src="./js/style.js"></script>



    <title>编写 kubernetes 资源描述文件 - 打工人日志</title>
</head>

<body>
    <div class="header-box">
    <img src="https://www.jobcher.com/images/logo.webp" id="logo" alt="logo" class="logo">
    <h1><a href="https://www.jobcher.com">打工人日志</a></h1>
</div>
<nav class="nav">
    <ul>
        
            <li>
                <a href="./">首页</a>
                
            </li>
        
            <li>
                <a href="https://nav.jobcher.com/">导航</a>
                
            </li>
        
            <li>
                <a href="./%E5%85%B3%E4%BA%8E%E6%88%91.html">关于</a>
                
            </li>
        
    </ul>
</nav>
    <div id="post" class="post">
        <header>
            <h2 class="post-title">编写 kubernetes 资源描述文件</h2>
            
        </header>
        <article class="article">
                <div class="single-content">
                    <h1 id="编写-kubernetes-资源描述文件">编写 kubernetes 资源描述文件</h1>
<h3 id="1-部署一个应用">1. 部署一个应用</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#f92672">apiVersion</span>: <span style="color:#ae81ff">apps/v1</span> <span style="color:#75715e">#与k8s集群版本有关，使用 kubectl api-versions 即可查看当前集群支持的版本</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">kind</span>: <span style="color:#ae81ff">Deployment</span> <span style="color:#75715e">#该配置的类型，我们使用的是 Deployment</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">metadata</span>: <span style="color:#75715e">#译名为元数据，即 Deployment 的一些基本属性和信息</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">name</span>: <span style="color:#ae81ff">nginx-deployment</span> <span style="color:#75715e">#Deployment 的名称</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">labels</span>: <span style="color:#75715e">#标签，可以灵活定位一个或多个资源，其中key和value均可自定义，可以定义多组，目前不需要理解</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">app</span>: <span style="color:#ae81ff">nginx</span> <span style="color:#75715e">#为该Deployment设置key为app，value为nginx的标签</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">spec</span>: <span style="color:#75715e">#这是关于该Deployment的描述，可以理解为你期待该Deployment在k8s中如何使用</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">replicas</span>: <span style="color:#ae81ff">1</span> <span style="color:#75715e">#使用该Deployment创建一个应用程序实例</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">selector</span>: <span style="color:#75715e">#标签选择器，与上面的标签共同作用，目前不需要理解</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">matchLabels</span>: <span style="color:#75715e">#选择包含标签app:nginx的资源</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">app</span>: <span style="color:#ae81ff">nginx</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">template</span>: <span style="color:#75715e">#这是选择或创建的Pod的模板</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">metadata</span>: <span style="color:#75715e">#Pod的元数据</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">labels</span>: <span style="color:#75715e">#Pod的标签，上面的selector即选择包含标签app:nginx的Pod</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">app</span>: <span style="color:#ae81ff">nginx</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">spec</span>: <span style="color:#75715e">#期望Pod实现的功能（即在pod中部署）</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">containers</span>: <span style="color:#75715e">#生成container，与docker中的container是同一种</span>
</span></span><span style="display:flex;"><span>        - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">nginx</span> <span style="color:#75715e">#container的名称</span>
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">image</span>: <span style="color:#ae81ff">nginx:1.7.9</span> <span style="color:#75715e">#使用镜像nginx:1.7.9创建container，该container默认80端口可访问</span>
</span></span></code></pre></div><blockquote>
<p>kubectl apply -f xxx.yaml</p>
</blockquote>
<h3 id="2暴露应用">2、暴露应用</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#f92672">apiVersion</span>: <span style="color:#ae81ff">v1</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">kind</span>: <span style="color:#ae81ff">Service</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">metadata</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">name</span>: <span style="color:#ae81ff">nginx-service</span> <span style="color:#75715e">#Service 的名称</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">labels</span>: <span style="color:#75715e">#Service 自己的标签</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">app</span>: <span style="color:#ae81ff">nginx</span> <span style="color:#75715e">#为该 Service 设置 key 为 app，value 为 nginx 的标签</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">spec</span>: <span style="color:#75715e">#这是关于该 Service 的定义，描述了 Service 如何选择 Pod，如何被访问</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">selector</span>: <span style="color:#75715e">#标签选择器</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">app</span>: <span style="color:#ae81ff">nginx</span> <span style="color:#75715e">#选择包含标签 app:nginx 的 Pod</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">ports</span>:
</span></span><span style="display:flex;"><span>    - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">nginx-port</span> <span style="color:#75715e">#端口的名字</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">protocol</span>: <span style="color:#ae81ff">TCP</span> <span style="color:#75715e">#协议类型 TCP/UDP</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">port</span>: <span style="color:#ae81ff">80</span> <span style="color:#75715e">#集群内的其他容器组可通过 80 端口访问 Service</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">nodePort</span>: <span style="color:#ae81ff">32600</span> <span style="color:#75715e">#通过任意节点的 32600 端口访问 Service</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">targetPort</span>: <span style="color:#ae81ff">80</span> <span style="color:#75715e">#将请求转发到匹配 Pod 的 80 端口</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">type</span>: <span style="color:#ae81ff">NodePort</span> <span style="color:#75715e">#Serive的类型，ClusterIP/NodePort/LoaderBalancer</span>
</span></span></code></pre></div><h3 id="3扩缩容">3、扩缩容</h3>
<p>修改 deployment.yaml 中的 replicas 属性即可</p>
<p>完成后运行 <code>kubectl apply -f xxx.yaml</code></p>
<h3 id="4滚动升级">4、滚动升级</h3>
<p>修改 deployment.yaml 中的 imageName 属性等</p>
<p>完成后运行 <code>kubectl apply -f xxx.yaml</code></p>

                </div>
            <br />
        <div>
                
                <a href="https://www.jobcher.com/kubernetes-%E4%BB%8E1.23.x-%E5%8D%87%E7%BA%A7%E5%88%B0-1.24.x.html" class="prev">前一页</a>
                
                
                <a href="https://www.jobcher.com/nginx-ssh-key-connection-exception.html" class="next">后一页</a>
                
            </div>
        </article>
    </div>

    <nav class="footer-nav">
        <ul>
            
            <li><a href="./%E5%85%B3%E4%BA%8E%E6%88%91.html">关于我们</a></li>
            
            <li><a href="./">网站首页</a></li>
            
            <li><a href=""></a></li>
            
        </ul>
    </nav>
    <footer class="footer">
    <span style="color: aliceblue;">© 2019-2023 by jobcher</span>
</footer>
</body>

</html>