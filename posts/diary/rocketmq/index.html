<!DOCTYPE html>
<html lang="zh">

<head>
    <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta http-equiv="X-UA-Compatible" content="ie=edge">
<link media="all" rel="stylesheet" href="/css/style.css">

<script src="/js/style.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/highlight.min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.8/clipboard.min.js"></script>

    <title>RocketMQ 安装和启动</title>
</head>

<body>
    <div class="header-box">
    <img src="https://test.jobcher.com/images/logo.webp" id="logo" alt="logo" class="logo">
    <h1><a href="https://test.jobcher.com">打工人日志</a></h1>
</div>
<nav class="nav">
    <ul>
        
            <li>
                <a href="/">首页</a>
                
            </li>
        
            <li>
                <a href="/posts">文章</a>
                
            </li>
        
            <li>
                <a href="https://nav.jobcher.com/">导航</a>
                
            </li>
        
            <li>
                <a href="/posts/about">关于</a>
                
            </li>
        
    </ul>
</nav>
    <div id="post" class="post">
        <header>
            <h2 class="post-title">RocketMQ 安装和启动</h2>
            
        </header>
        <article class="article">
                <div class="single-content">
                    <h1 id="rocketmq-安装和部署">RocketMQ 安装和部署</h1>
<p>部署 RocketMQ</p>
<h2 id="单机安装构建">单机安装构建</h2>
<ol>
<li>安装 JDK 1.8.0</li>
</ol>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>yum install java-1.8.0-openjdk*
</span></span></code></pre></div><ol start="2">
<li>安装 Maven</li>
</ol>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>wget http://dlcdn.apache.org/maven/maven-3/3.8.4/binaries/apache-maven-3.8.4-bin.tar.gz
</span></span><span style="display:flex;"><span>tar -zxvf apache-maven-3.8.4-bin.tar.gz
</span></span><span style="display:flex;"><span>mv -f apache-maven-3.8.4 /usr/local/
</span></span><span style="display:flex;"><span>vim /etc/profile
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 末尾添加</span>
</span></span><span style="display:flex;"><span>export MAVEN_HOME<span style="color:#f92672">=</span>/usr/local/apache-maven-3.8.4
</span></span><span style="display:flex;"><span>export PATH<span style="color:#f92672">=</span><span style="color:#e6db74">${</span>PATH<span style="color:#e6db74">}</span>:<span style="color:#e6db74">${</span>MAVEN_HOME<span style="color:#e6db74">}</span>/bin
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 保存</span>
</span></span><span style="display:flex;"><span>source /etc/profile
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 查看maven是否正常</span>
</span></span><span style="display:flex;"><span>mvn -v
</span></span></code></pre></div><h2 id="快速部署">快速部署</h2>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span><span style="color:#75715e">#构建 DLedger</span>
</span></span><span style="display:flex;"><span>git clone https://github.com/openmessaging/openmessaging-storage-dledger.git
</span></span><span style="display:flex;"><span>cd openmessaging-storage-dledger
</span></span><span style="display:flex;"><span>mvn clean install -DskipTests
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 构建 RocketMQ</span>
</span></span><span style="display:flex;"><span>git clone https://github.com/apache/rocketmq.git
</span></span><span style="display:flex;"><span>cd rocketmq
</span></span><span style="display:flex;"><span>git checkout -b store_with_dledger origin/store_with_dledger
</span></span><span style="display:flex;"><span>mvn -Prelease-all -DskipTests clean install -U
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 部署</span>
</span></span><span style="display:flex;"><span>cd rocketmq/distribution/target/apache-rocketmq
</span></span><span style="display:flex;"><span>sh bin/dledger/fast-try.sh start
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 通过 mqadmin 运维命令查看集群状态</span>
</span></span><span style="display:flex;"><span>sh bin/mqadmin clusterList -n 127.0.0.1:9876
</span></span></code></pre></div><p>启动单节点</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>cd distribution/target/rocketmq-4.9.3-SNAPSHOT/rocketmq-4.9.3-SNAPSHOT
</span></span><span style="display:flex;"><span>nohup sh bin/mqnamesrv &amp;
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 查看 Namesrv 日志</span>
</span></span><span style="display:flex;"><span>tail -f ~/logs/rocketmqlogs/namesrv.log
</span></span><span style="display:flex;"><span>2022-01-07 14:59:29 INFO main - The Name Server boot success. serializeType<span style="color:#f92672">=</span>JSON
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 启动 Broker</span>
</span></span><span style="display:flex;"><span>nohup sh bin/mqbroker -c conf/broker.conf  -n 127.0.0.1:9876 &amp;
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 查看 Broker 日志</span>
</span></span><span style="display:flex;"><span>tail -f ~/logs/rocketmqlogs/broker.log
</span></span></code></pre></div><p>如果提示找不到上面的日志文件，应该是没启动成功。<br>
应该是内存不够，RocketMQ 默认用 8g 内存，如果你服务器的内存比较小，可以修改下 bin/runbroker.sh 脚本，将 Broker JVM 内存调小。如：JAVA_OPT=&quot;${JAVA_OPT} -server -Xms2g -Xmx2g -Xmn1g&quot;。<br>
再次启动 broker，可以正常启动。</p>
<p>默认情况下，Broker 日志文件所在地址为~/logs/rocketmqlogs/broker.log。如果想要自定义，可以通过 conf/logback_broker.xml 配置文件来进行修改。</p>

                </div>
            <br />
        <div>
                
                <a href="https://test.jobcher.com/posts/kubernetes/k8s1/" class="prev">前一页</a>
                
                
                <a href="https://test.jobcher.com/posts/diary/minio/" class="next">后一页</a>
                
            </div>
        </article>
    </div>

    <nav class="footer-nav">
        <ul>
            
            <li><a href="/posts/about">关于我们</a></li>
            
            <li><a href="/posts">博文合集</a></li>
            
            <li><a href="/">网站首页</a></li>
            
        </ul>
    </nav>
    <footer class="footer">
    <span style="color: aliceblue;">© 2019-2023 by jobcher</span>
</footer>
</body>

</html>