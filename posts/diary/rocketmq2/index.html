<!DOCTYPE html>
<html lang="zh">

<head>
    <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta http-equiv="X-UA-Compatible" content="ie=edge">
<link media="all" rel="stylesheet" href="/css/style.css">

<script src="/js/style.js"></script>



    <title>RocketMQ docker-compose部署 4主4从集群</title>
</head>

<body>
    <div class="header-box">
    <img src="https://test.jobcher.com/images/logo.webp" id="logo" alt="logo" class="logo">
    <h1><a href="https://test.jobcher.com">打工人日志</a></h1>
</div>
<nav class="nav">
    <ul>
        
            <li>
                <a href="/">首页</a>
                
            </li>
        
            <li>
                <a href="/posts">文章</a>
                
            </li>
        
            <li>
                <a href="https://nav.jobcher.com/">导航</a>
                
            </li>
        
            <li>
                <a href="/posts/about">关于</a>
                
            </li>
        
    </ul>
</nav>
    <div id="post" class="post">
        <header>
            <h2 class="post-title">RocketMQ docker-compose部署 4主4从集群</h2>
            
        </header>
        <article class="article">
                <div class="single-content">
                    <h1 id="rocketmq-docker-compose-部署-4-主-4-从集群">RocketMQ docker-compose 部署 4 主 4 从集群</h1>
<p>V 4.8.0<br>
采用<code>4主4从</code>，<code>同步模式</code>。HA 实现上采用<code>Master/Slave+Failover</code>组件方式
每台主机运行<code>三个容器</code>，分别为<code>NameServer</code>、<code>BrokerMaster</code>、<code>SlaveMaster</code>，每个 Master 和 Slave 分别存放在不同的机器上</p>
<h2 id="架构">架构</h2>
<p><img src="/images/rocketmq.svg" alt="架构"></p>
<table>
<thead>
<tr>
<th style="text-align:left">IP</th>
<th style="text-align:left">角色</th>
<th style="text-align:left">服务</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">193.0.40.172</td>
<td style="text-align:left">NameServer</td>
<td style="text-align:left">-</td>
</tr>
<tr>
<td style="text-align:left">193.0.40.172</td>
<td style="text-align:left">BrokerMaster</td>
<td style="text-align:left">broker-a</td>
</tr>
<tr>
<td style="text-align:left">193.0.40.172</td>
<td style="text-align:left">SlaveMaster</td>
<td style="text-align:left">broker-d-s</td>
</tr>
<tr>
<td style="text-align:left">193.0.40.172</td>
<td style="text-align:left">BrokerMaster</td>
<td style="text-align:left">broker-b</td>
</tr>
<tr>
<td style="text-align:left">193.0.40.172</td>
<td style="text-align:left">SlaveMaster</td>
<td style="text-align:left">broker-a-s</td>
</tr>
<tr>
<td style="text-align:left">193.0.40.172</td>
<td style="text-align:left">BrokerMaster</td>
<td style="text-align:left">broker-c</td>
</tr>
<tr>
<td style="text-align:left">193.0.40.172</td>
<td style="text-align:left">SlaveMaster</td>
<td style="text-align:left">broker-b-s</td>
</tr>
<tr>
<td style="text-align:left">193.0.40.172</td>
<td style="text-align:left">BrokerMaster</td>
<td style="text-align:left">broker-d</td>
</tr>
<tr>
<td style="text-align:left">193.0.40.172</td>
<td style="text-align:left">SlaveMaster</td>
<td style="text-align:left">broker-c-s</td>
</tr>
</tbody>
</table>
<h2 id="部署">部署</h2>
<h3 id="安装-docker-compose">安装 docker-compose</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span><span style="color:#75715e">#!/bin/bash
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#75715e"># 下载安装 v2.4.1 docker-compose</span>
</span></span><span style="display:flex;"><span>curl -L https://get.daocloud.io/docker/compose/releases/download/v2.4.1/docker-compose-<span style="color:#e6db74">`</span>uname -s<span style="color:#e6db74">`</span>-<span style="color:#e6db74">`</span>uname -m<span style="color:#e6db74">`</span> &gt; /usr/local/bin/docker-compose
</span></span><span style="display:flex;"><span>sudo chmod +x /usr/local/bin/docker-compose
</span></span><span style="display:flex;"><span>sudo ln -s /usr/local/bin/docker-compose /usr/bin/docker-compose
</span></span><span style="display:flex;"><span>docker-compose --version
</span></span></code></pre></div><p>执行 <code>docker-compose --version</code> 查看是否安装成功</p>
<h3 id="生成配置文件">生成配置文件</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span><span style="color:#75715e">#!/bin/bash
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#75715e">#docker-compose 生成配置文件</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>mkdir -p /rocketmq/data/namesv1
</span></span><span style="display:flex;"><span>mkdir -p /rocketmq/logs/namesv1
</span></span><span style="display:flex;"><span>mkdir -p /rocketmq/data/namesv2
</span></span><span style="display:flex;"><span>mkdir -p /rocketmq/logs/namesv2
</span></span><span style="display:flex;"><span>mkdir -p /rocketmq/config/broker-a
</span></span><span style="display:flex;"><span>mkdir -p /rocketmq/data/broker-a
</span></span><span style="display:flex;"><span>mkdir -p /rocketmq/logs/broker-a
</span></span><span style="display:flex;"><span>mkdir -p /rocketmq/config/broker-a-s
</span></span><span style="display:flex;"><span>mkdir -p /rocketmq/data/broker-a-s
</span></span><span style="display:flex;"><span>mkdir -p /rocketmq/logs/broker-a-s
</span></span><span style="display:flex;"><span>mkdir -p /rocketmq/config/broker-b
</span></span><span style="display:flex;"><span>mkdir -p /rocketmq/data/broker-b
</span></span><span style="display:flex;"><span>mkdir -p /rocketmq/logs/broker-b
</span></span><span style="display:flex;"><span>mkdir -p /rocketmq/config/broker-b-s
</span></span><span style="display:flex;"><span>mkdir -p /rocketmq/data/broker-b-s
</span></span><span style="display:flex;"><span>mkdir -p /rocketmq/logs/broker-b-s
</span></span><span style="display:flex;"><span>mkdir -p /rocketmq/config/broker-c
</span></span><span style="display:flex;"><span>mkdir -p /rocketmq/data/broker-c
</span></span><span style="display:flex;"><span>mkdir -p /rocketmq/logs/broker-c
</span></span><span style="display:flex;"><span>mkdir -p /rocketmq/config/broker-c-s
</span></span><span style="display:flex;"><span>mkdir -p /rocketmq/data/broker-c-s
</span></span><span style="display:flex;"><span>mkdir -p /rocketmq/logs/broker-c-s
</span></span><span style="display:flex;"><span>mkdir -p /rocketmq/config/broker-d
</span></span><span style="display:flex;"><span>mkdir -p /rocketmq/data/broker-d
</span></span><span style="display:flex;"><span>mkdir -p /rocketmq/logs/broker-d
</span></span><span style="display:flex;"><span>mkdir -p /rocketmq/config/broker-d-s
</span></span><span style="display:flex;"><span>mkdir -p /rocketmq/data/broker-d-s
</span></span><span style="display:flex;"><span>mkdir -p /rocketmq/logs/broker-d-s
</span></span><span style="display:flex;"><span>cd /rocketmq/config/broker-a
</span></span><span style="display:flex;"><span>cat &gt; broker-a.conf <span style="color:#e6db74">&lt;&lt;EOF
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">#集群名称
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">brokerClusterName=DefaultCluster
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">#broker名称
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">brokerName=broker-a
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">#brokerId master用0 slave用其他
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">brokerId=0
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">#清理时机
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">deleteWhen=4
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">#文件保留时长 48小时
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">fileReservedTime=48
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">#broker角色 -ASYNC_MASTER异步复制 -SYNC_MASTER同步双写 -SLAVE
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">brokerRole=SYNC_MASTER
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">#刷盘策略 - ASYNC_FLUSH 异步刷盘 - SYNC_FLUSH 同步刷盘
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">flushDiskType=SYNC_FLUSH
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">#主机ip
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">brokerIP1=193.0.40.172
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">#对外服务的监听接口，同一台机器上部署多个broker,端口号要不相同
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">listenPort=10911
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">#namesvr
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">namesrvAddr=193.0.40.172:9876;193.0.40.172:9877
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">#是否能够自动创建topic
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">autoCreateTopicEnable=true
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EOF</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 生成配置文件</span>
</span></span><span style="display:flex;"><span>cd /rocketmq/config/broker-a-s
</span></span><span style="display:flex;"><span>cat &gt; broker-a-s.conf <span style="color:#e6db74">&lt;&lt;EOF
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">#集群名称
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">brokerClusterName=DefaultCluster
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">#broker名称
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">brokerName=broker-a
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">#brokerId master用0 slave用其他
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">brokerId=1
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">#清理时机
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">deleteWhen=4
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">#文件保留时长 48小时
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">fileReservedTime=48
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">#broker角色 -ASYNC_MASTER异步复制 -SYNC_MASTER同步双写 -SLAVE
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">brokerRole=SLAVE
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">#刷盘策略 - ASYNC_FLUSH 异步刷盘 - SYNC_FLUSH 同步刷盘
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">flushDiskType=SYNC_FLUSH
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">#主机ip
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">brokerIP1=193.0.40.172
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">#对外服务的监听接口，同一台机器上部署多个broker,端口号要不相同
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">listenPort=11911
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">#namesrv
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">namesrvAddr=193.0.40.172:9876;193.0.40.172:9877
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">#是否能够自动创建topic
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">autoCreateTopicEnable=true
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EOF</span>
</span></span><span style="display:flex;"><span>cd /rocketmq/config/broker-b
</span></span><span style="display:flex;"><span>cat &gt; broker-b.conf <span style="color:#e6db74">&lt;&lt;EOF
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">#集群名称
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">brokerClusterName=DefaultCluster
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">#broker名称
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">brokerName=broker-b
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">#brokerId master用0 slave用其他
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">brokerId=0
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">#清理时机
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">deleteWhen=4
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">#文件保留时长 48小时
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">fileReservedTime=48
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">#broker角色 -ASYNC_MASTER异步复制 -SYNC_MASTER同步双写 -SLAVE
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">brokerRole=SYNC_MASTER
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">#刷盘策略 - ASYNC_FLUSH 异步刷盘 - SYNC_FLUSH 同步刷盘
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">flushDiskType=SYNC_FLUSH
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">#主机ip
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">brokerIP1=193.0.40.172
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">#对外服务的监听接口，同一台机器上部署多个broker,端口号要不相同
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">listenPort=12911
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">#namesrv
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">namesrvAddr=193.0.40.172:9876;193.0.40.172:9877
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">#是否能够自动创建topic
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">autoCreateTopicEnable=true
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EOF</span>
</span></span><span style="display:flex;"><span>cd /rocketmq/config/broker-b-s
</span></span><span style="display:flex;"><span>cat &gt; broker-b-s.conf <span style="color:#e6db74">&lt;&lt;EOF
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">#集群名称
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">brokerClusterName=DefaultCluster
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">#broker名称
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">brokerName=broker-b
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">#brokerId master用0 slave用其他
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">brokerId=1
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">#清理时机
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">deleteWhen=4
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">#文件保留时长 48小时
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">fileReservedTime=48
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">#broker角色 -ASYNC_MASTER异步复制 -SYNC_MASTER同步双写 -SLAVE
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">brokerRole=SLAVE
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">#刷盘策略 - ASYNC_FLUSH 异步刷盘 - SYNC_FLUSH 同步刷盘
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">flushDiskType=SYNC_FLUSH
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">#主机ip
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">brokerIP1=193.0.40.172
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">#对外服务的监听接口，同一台机器上部署多个broker,端口号要不相同
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">listenPort=13911
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">#namesrv
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">namesrvAddr=193.0.40.172:9876;193.0.40.172:9877
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">#是否能够自动创建topic
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">autoCreateTopicEnable=true
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EOF</span>
</span></span><span style="display:flex;"><span>cd /rocketmq/config/broker-c
</span></span><span style="display:flex;"><span>cat &gt; broker-c.conf <span style="color:#e6db74">&lt;&lt;EOF
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">#集群名称
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">brokerClusterName=DefaultCluster
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">#broker名称
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">brokerName=broker-c
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">#brokerId master用0 slave用其他
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">brokerId=0
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">#清理时机
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">deleteWhen=4
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">#文件保留时长 48小时
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">fileReservedTime=48
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">#broker角色 -ASYNC_MASTER异步复制 -SYNC_MASTER同步双写 -SLAVE
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">brokerRole=SYNC_MASTER
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">#刷盘策略 - ASYNC_FLUSH 异步刷盘 - SYNC_FLUSH 同步刷盘
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">flushDiskType=SYNC_FLUSH
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">#主机ip
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">brokerIP1=193.0.40.172
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">#对外服务的监听接口，同一台机器上部署多个broker,端口号要不相同
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">listenPort=14911
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">#namesrv
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">namesrvAddr=193.0.40.172:9876;193.0.40.172:9877
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">#是否能够自动创建topic
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">autoCreateTopicEnable=true
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EOF</span>
</span></span><span style="display:flex;"><span>cd /rocketmq/config/broker-c-s
</span></span><span style="display:flex;"><span>cat &gt; broker-c-s.conf <span style="color:#e6db74">&lt;&lt;EOF
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">#集群名称
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">brokerClusterName=DefaultCluster
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">#broker名称
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">brokerName=broker-c
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">#brokerId master用0 slave用其他
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">brokerId=1
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">#清理时机
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">deleteWhen=4
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">#文件保留时长 48小时
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">fileReservedTime=48
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">#broker角色 -ASYNC_MASTER异步复制 -SYNC_MASTER同步双写 -SLAVE
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">brokerRole=SLAVE
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">#刷盘策略 - ASYNC_FLUSH 异步刷盘 - SYNC_FLUSH 同步刷盘
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">flushDiskType=SYNC_FLUSH
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">#主机ip
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">brokerIP1=193.0.40.172
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">#对外服务的监听接口，同一台机器上部署多个broker,端口号要不相同
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">listenPort=15911
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">#namesrv
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">namesrvAddr=193.0.40.172:9876;193.0.40.172:9877
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">#是否能够自动创建topic
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">autoCreateTopicEnable=true
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EOF</span>
</span></span><span style="display:flex;"><span>cd /rocketmq/config/broker-d
</span></span><span style="display:flex;"><span>cat &gt; broker-d.conf <span style="color:#e6db74">&lt;&lt;EOF
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">#集群名称
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">brokerClusterName=DefaultCluster
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">#broker名称
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">brokerName=broker-d
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">#brokerId master用0 slave用其他
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">brokerId=0
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">#清理时机
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">deleteWhen=4
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">#文件保留时长 48小时
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">fileReservedTime=48
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">#broker角色 -ASYNC_MASTER异步复制 -SYNC_MASTER同步双写 -SLAVE
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">brokerRole=SYNC_MASTER
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">#刷盘策略 - ASYNC_FLUSH 异步刷盘 - SYNC_FLUSH 同步刷盘
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">flushDiskType=SYNC_FLUSH
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">#主机ip
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">brokerIP1=193.0.40.172
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">#对外服务的监听接口，同一台机器上部署多个broker,端口号要不相同
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">listenPort=16911
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">#namesrv
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">namesrvAddr=193.0.40.172:9876;193.0.40.172:9877
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">#是否能够自动创建topic
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">autoCreateTopicEnable=true
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EOF</span>
</span></span><span style="display:flex;"><span>cd /rocketmq/config/broker-d-s
</span></span><span style="display:flex;"><span>cat &gt; broker-d-s.conf <span style="color:#e6db74">&lt;&lt;EOF
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">#集群名称
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">brokerClusterName=DefaultCluster
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">#broker名称
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">brokerName=broker-d
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">#brokerId master用0 slave用其他
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">brokerId=1
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">#清理时机
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">deleteWhen=4
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">#文件保留时长 48小时
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">fileReservedTime=48
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">#broker角色 -ASYNC_MASTER异步复制 -SYNC_MASTER同步双写 -SLAVE
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">brokerRole=SLAVE
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">#刷盘策略 - ASYNC_FLUSH 异步刷盘 - SYNC_FLUSH 同步刷盘
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">flushDiskType=SYNC_FLUSH
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">#主机ip
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">brokerIP1=193.0.40.172
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">#对外服务的监听接口，同一台机器上部署多个broker,端口号要不相同
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">listenPort=17911
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">#namesrv
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">namesrvAddr=193.0.40.172:9876;193.0.40.172:9877
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">#是否能够自动创建topic
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">autoCreateTopicEnable=true
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EOF</span>
</span></span></code></pre></div><p>执行<code>rocker-config.sh</code>,确认配置文件是否生成</p>
<blockquote>
<p>tree /rocketmq</p>
</blockquote>
<h3 id="执行-docker-composeyaml-文件">执行 docker-compose.yaml 文件</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#f92672">version</span>: <span style="color:#e6db74">&#34;3&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">services</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">rocketmq-namesv1</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">image</span>: <span style="color:#ae81ff">apache/rocketmq:4.8.0</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">container_name</span>: <span style="color:#ae81ff">rocketmq-namesv1</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">restart</span>: <span style="color:#ae81ff">always</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">ports</span>:
</span></span><span style="display:flex;"><span>      - <span style="color:#ae81ff">9876</span>:<span style="color:#ae81ff">9876</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">volumes</span>:
</span></span><span style="display:flex;"><span>      - <span style="color:#ae81ff">/rocketmq/logs/namesv1:/home/rocketmq/logs</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">environment</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">JAVA_OPT_EXT</span>: -<span style="color:#ae81ff">server -Xms256M -Xmx256M -Xmn128m</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">command</span>: <span style="color:#ae81ff">sh mqnamesrv</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">networks</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">rocketmq</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">aliases</span>:
</span></span><span style="display:flex;"><span>          - <span style="color:#ae81ff">rocketmq-namesv1</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">rocketmq-namesv2</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">image</span>: <span style="color:#ae81ff">apache/rocketmq:4.8.0</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">container_name</span>: <span style="color:#ae81ff">rocketmq-namesv2</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">restart</span>: <span style="color:#ae81ff">always</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">ports</span>:
</span></span><span style="display:flex;"><span>      - <span style="color:#ae81ff">9877</span>:<span style="color:#ae81ff">9876</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">volumes</span>:
</span></span><span style="display:flex;"><span>      - <span style="color:#ae81ff">/rocketmq/logs/namesv2:/home/rocketmq/logs</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">environment</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">JAVA_OPT_EXT</span>: -<span style="color:#ae81ff">server -Xms256M -Xmx256M -Xmn128m</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">command</span>: <span style="color:#ae81ff">sh mqnamesrv</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">networks</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">rocketmq</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">aliases</span>:
</span></span><span style="display:flex;"><span>          - <span style="color:#ae81ff">rocketmq-namesv2</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">broker-a</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">image</span>: <span style="color:#ae81ff">apache/rocketmq:4.8.0</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">container_name</span>: <span style="color:#ae81ff">broker-a</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">links</span>:
</span></span><span style="display:flex;"><span>      - <span style="color:#ae81ff">rocketmq-namesv1:rocketmq-namesv1</span>
</span></span><span style="display:flex;"><span>      - <span style="color:#ae81ff">rocketmq-namesv2:rocketmq-namesv2</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">ports</span>:
</span></span><span style="display:flex;"><span>      - <span style="color:#ae81ff">10909</span>:<span style="color:#ae81ff">10909</span>
</span></span><span style="display:flex;"><span>      - <span style="color:#ae81ff">10911</span>:<span style="color:#ae81ff">10911</span>
</span></span><span style="display:flex;"><span>      - <span style="color:#ae81ff">10912</span>:<span style="color:#ae81ff">10912</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">environment</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">TZ</span>: <span style="color:#ae81ff">Asia/Shanghai</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">NAMESRV_ADDR</span>: <span style="color:#e6db74">&#34;rocketmq-namesv1:9876&#34;</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">JAVA_OPT_EXT</span>: <span style="color:#e6db74">&#34;-server -Xms256M -Xmx256M -Xmn128m&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">volumes</span>:
</span></span><span style="display:flex;"><span>      - <span style="color:#ae81ff">/rocketmq/logs/broker-a:/home/rocketmq/logs</span>
</span></span><span style="display:flex;"><span>      - <span style="color:#ae81ff">/rocketmq/config/broker-a/broker-a.conf:/home/rocketmq/rocketmq-4.8.0/conf/broker.conf</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">command</span>: <span style="color:#ae81ff">sh mqbroker  -c /home/rocketmq/rocketmq-4.8.0/conf/broker.conf autoCreateTopicEnable=true &amp;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">networks</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">rocketmq</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">aliases</span>:
</span></span><span style="display:flex;"><span>          - <span style="color:#ae81ff">broker-a</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">broker-a-s</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">image</span>: <span style="color:#ae81ff">apache/rocketmq:4.8.0</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">container_name</span>: <span style="color:#ae81ff">broker-a-s</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">links</span>:
</span></span><span style="display:flex;"><span>      - <span style="color:#ae81ff">rocketmq-namesv1:rocketmq-namesv1</span>
</span></span><span style="display:flex;"><span>      - <span style="color:#ae81ff">rocketmq-namesv2:rocketmq-namesv2</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">ports</span>:
</span></span><span style="display:flex;"><span>      - <span style="color:#ae81ff">11909</span>:<span style="color:#ae81ff">10909</span>
</span></span><span style="display:flex;"><span>      - <span style="color:#ae81ff">11911</span>:<span style="color:#ae81ff">11911</span>
</span></span><span style="display:flex;"><span>      - <span style="color:#ae81ff">11912</span>:<span style="color:#ae81ff">10912</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">environment</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">TZ</span>: <span style="color:#ae81ff">Asia/Shanghai</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">NAMESRV_ADDR</span>: <span style="color:#e6db74">&#34;rocketmq-namesv1:9876&#34;</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">JAVA_OPT_EXT</span>: <span style="color:#e6db74">&#34;-server -Xms256M -Xmx256M -Xmn128m&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">volumes</span>:
</span></span><span style="display:flex;"><span>      - <span style="color:#ae81ff">/rocketmq/logs/broker-a-s:/home/rocketmq/logs</span>
</span></span><span style="display:flex;"><span>      - <span style="color:#ae81ff">/rocketmq/config/broker-a-s/broker-a-s.conf:/home/rocketmq/rocketmq-4.8.0/conf/broker.conf</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">command</span>: <span style="color:#ae81ff">sh mqbroker  -c /home/rocketmq/rocketmq-4.8.0/conf/broker.conf autoCreateTopicEnable=true &amp;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">networks</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">rocketmq</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">aliases</span>:
</span></span><span style="display:flex;"><span>          - <span style="color:#ae81ff">broker-a-s</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">broker-b</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">image</span>: <span style="color:#ae81ff">apache/rocketmq:4.8.0</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">container_name</span>: <span style="color:#ae81ff">broker-b</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">links</span>:
</span></span><span style="display:flex;"><span>      - <span style="color:#ae81ff">rocketmq-namesv1:rocketmq-namesv1</span>
</span></span><span style="display:flex;"><span>      - <span style="color:#ae81ff">rocketmq-namesv2:rocketmq-namesv2</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">ports</span>:
</span></span><span style="display:flex;"><span>      - <span style="color:#ae81ff">12909</span>:<span style="color:#ae81ff">10909</span>
</span></span><span style="display:flex;"><span>      - <span style="color:#ae81ff">12911</span>:<span style="color:#ae81ff">12911</span>
</span></span><span style="display:flex;"><span>      - <span style="color:#ae81ff">12912</span>:<span style="color:#ae81ff">10912</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">environment</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">TZ</span>: <span style="color:#ae81ff">Asia/Shanghai</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">NAMESRV_ADDR</span>: <span style="color:#e6db74">&#34;rocketmq-namesv1:9876&#34;</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">JAVA_OPT_EXT</span>: <span style="color:#e6db74">&#34;-server -Xms256M -Xmx256M -Xmn128m&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">volumes</span>:
</span></span><span style="display:flex;"><span>      - <span style="color:#ae81ff">/rocketmq/logs/broker-b:/home/rocketmq/logs</span>
</span></span><span style="display:flex;"><span>      - <span style="color:#ae81ff">/rocketmq/config/broker-b/broker-b.conf:/home/rocketmq/rocketmq-4.8.0/conf/broker.conf</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">command</span>: <span style="color:#ae81ff">sh mqbroker  -c /home/rocketmq/rocketmq-4.8.0/conf/broker.conf autoCreateTopicEnable=true &amp;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">networks</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">rocketmq</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">aliases</span>:
</span></span><span style="display:flex;"><span>          - <span style="color:#ae81ff">broker-b</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">broker-b-s</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">image</span>: <span style="color:#ae81ff">apache/rocketmq:4.8.0</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">container_name</span>: <span style="color:#ae81ff">broker-b-s</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">links</span>:
</span></span><span style="display:flex;"><span>      - <span style="color:#ae81ff">rocketmq-namesv1:rocketmq-namesv1</span>
</span></span><span style="display:flex;"><span>      - <span style="color:#ae81ff">rocketmq-namesv2:rocketmq-namesv2</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">ports</span>:
</span></span><span style="display:flex;"><span>      - <span style="color:#ae81ff">13909</span>:<span style="color:#ae81ff">10909</span>
</span></span><span style="display:flex;"><span>      - <span style="color:#ae81ff">13911</span>:<span style="color:#ae81ff">13911</span>
</span></span><span style="display:flex;"><span>      - <span style="color:#ae81ff">13912</span>:<span style="color:#ae81ff">10912</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">environment</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">TZ</span>: <span style="color:#ae81ff">Asia/Shanghai</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">NAMESRV_ADDR</span>: <span style="color:#e6db74">&#34;rocketmq-namesv1:9876&#34;</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">JAVA_OPT_EXT</span>: <span style="color:#e6db74">&#34;-server -Xms256M -Xmx256M -Xmn128m&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">volumes</span>:
</span></span><span style="display:flex;"><span>      - <span style="color:#ae81ff">/rocketmq/logs/broker-b-s:/home/rocketmq/logs</span>
</span></span><span style="display:flex;"><span>      - <span style="color:#ae81ff">/rocketmq/config/broker-b-s/broker-b-s.conf:/home/rocketmq/rocketmq-4.8.0/conf/broker.conf</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">command</span>: <span style="color:#ae81ff">sh mqbroker  -c /home/rocketmq/rocketmq-4.8.0/conf/broker.conf autoCreateTopicEnable=true &amp;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">networks</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">rocketmq</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">aliases</span>:
</span></span><span style="display:flex;"><span>          - <span style="color:#ae81ff">broker-b-s</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">broker-c</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">image</span>: <span style="color:#ae81ff">apache/rocketmq:4.8.0</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">container_name</span>: <span style="color:#ae81ff">broker-c</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">links</span>:
</span></span><span style="display:flex;"><span>      - <span style="color:#ae81ff">rocketmq-namesv1:rocketmq-namesv1</span>
</span></span><span style="display:flex;"><span>      - <span style="color:#ae81ff">rocketmq-namesv2:rocketmq-namesv2</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">ports</span>:
</span></span><span style="display:flex;"><span>      - <span style="color:#ae81ff">14909</span>:<span style="color:#ae81ff">10909</span>
</span></span><span style="display:flex;"><span>      - <span style="color:#ae81ff">14911</span>:<span style="color:#ae81ff">14911</span>
</span></span><span style="display:flex;"><span>      - <span style="color:#ae81ff">14912</span>:<span style="color:#ae81ff">10912</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">environment</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">TZ</span>: <span style="color:#ae81ff">Asia/Shanghai</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">NAMESRV_ADDR</span>: <span style="color:#e6db74">&#34;rocketmq-namesv1:9876&#34;</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">JAVA_OPT_EXT</span>: <span style="color:#e6db74">&#34;-server -Xms256M -Xmx256M -Xmn128m&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">volumes</span>:
</span></span><span style="display:flex;"><span>      - <span style="color:#ae81ff">/rocketmq/logs/broker-c:/home/rocketmq/logs</span>
</span></span><span style="display:flex;"><span>      - <span style="color:#ae81ff">/rocketmq/config/broker-c/broker-c.conf:/home/rocketmq/rocketmq-4.8.0/conf/broker.conf</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">command</span>: <span style="color:#ae81ff">sh mqbroker  -c /home/rocketmq/rocketmq-4.8.0/conf/broker.conf autoCreateTopicEnable=true &amp;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">networks</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">rocketmq</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">aliases</span>:
</span></span><span style="display:flex;"><span>          - <span style="color:#ae81ff">broker-c</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">broker-c-s</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">image</span>: <span style="color:#ae81ff">apache/rocketmq:4.8.0</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">container_name</span>: <span style="color:#ae81ff">broker-c-s</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">links</span>:
</span></span><span style="display:flex;"><span>      - <span style="color:#ae81ff">rocketmq-namesv1:rocketmq-namesv1</span>
</span></span><span style="display:flex;"><span>      - <span style="color:#ae81ff">rocketmq-namesv2:rocketmq-namesv2</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">ports</span>:
</span></span><span style="display:flex;"><span>      - <span style="color:#ae81ff">15909</span>:<span style="color:#ae81ff">10909</span>
</span></span><span style="display:flex;"><span>      - <span style="color:#ae81ff">15911</span>:<span style="color:#ae81ff">15911</span>
</span></span><span style="display:flex;"><span>      - <span style="color:#ae81ff">15912</span>:<span style="color:#ae81ff">10912</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">environment</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">TZ</span>: <span style="color:#ae81ff">Asia/Shanghai</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">NAMESRV_ADDR</span>: <span style="color:#e6db74">&#34;rocketmq-namesv1:9876&#34;</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">JAVA_OPT_EXT</span>: <span style="color:#e6db74">&#34;-server -Xms256M -Xmx256M -Xmn128m&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">volumes</span>:
</span></span><span style="display:flex;"><span>      - <span style="color:#ae81ff">/rocketmq/logs/broker-c-s:/home/rocketmq/logs</span>
</span></span><span style="display:flex;"><span>      - <span style="color:#ae81ff">/rocketmq/config/broker-c-s/broker-c-s.conf:/home/rocketmq/rocketmq-4.8.0/conf/broker.conf</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">command</span>: <span style="color:#ae81ff">sh mqbroker  -c /home/rocketmq/rocketmq-4.8.0/conf/broker.conf autoCreateTopicEnable=true &amp;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">networks</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">rocketmq</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">aliases</span>:
</span></span><span style="display:flex;"><span>          - <span style="color:#ae81ff">broker-c-s</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">broker-d</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">image</span>: <span style="color:#ae81ff">apache/rocketmq:4.8.0</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">container_name</span>: <span style="color:#ae81ff">broker-d</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">links</span>:
</span></span><span style="display:flex;"><span>      - <span style="color:#ae81ff">rocketmq-namesv1:rocketmq-namesv1</span>
</span></span><span style="display:flex;"><span>      - <span style="color:#ae81ff">rocketmq-namesv2:rocketmq-namesv2</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">ports</span>:
</span></span><span style="display:flex;"><span>      - <span style="color:#ae81ff">16909</span>:<span style="color:#ae81ff">10909</span>
</span></span><span style="display:flex;"><span>      - <span style="color:#ae81ff">16911</span>:<span style="color:#ae81ff">16911</span>
</span></span><span style="display:flex;"><span>      - <span style="color:#ae81ff">16912</span>:<span style="color:#ae81ff">10912</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">environment</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">TZ</span>: <span style="color:#ae81ff">Asia/Shanghai</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">NAMESRV_ADDR</span>: <span style="color:#e6db74">&#34;rocketmq-namesv1:9876&#34;</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">JAVA_OPT_EXT</span>: <span style="color:#e6db74">&#34;-server -Xms256M -Xmx256M -Xmn128m&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">volumes</span>:
</span></span><span style="display:flex;"><span>      - <span style="color:#ae81ff">/rocketmq/logs/broker-d:/home/rocketmq/logs</span>
</span></span><span style="display:flex;"><span>      - <span style="color:#ae81ff">/rocketmq/config/broker-d/broker-d.conf:/home/rocketmq/rocketmq-4.8.0/conf/broker.conf</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">command</span>: <span style="color:#ae81ff">sh mqbroker  -c /home/rocketmq/rocketmq-4.8.0/conf/broker.conf autoCreateTopicEnable=true &amp;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">networks</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">rocketmq</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">aliases</span>:
</span></span><span style="display:flex;"><span>          - <span style="color:#ae81ff">broker-d</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">broker-d-s</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">image</span>: <span style="color:#ae81ff">apache/rocketmq:4.8.0</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">container_name</span>: <span style="color:#ae81ff">broker-d-s</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">links</span>:
</span></span><span style="display:flex;"><span>      - <span style="color:#ae81ff">rocketmq-namesv1:rocketmq-namesv1</span>
</span></span><span style="display:flex;"><span>      - <span style="color:#ae81ff">rocketmq-namesv2:rocketmq-namesv2</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">ports</span>:
</span></span><span style="display:flex;"><span>      - <span style="color:#ae81ff">17909</span>:<span style="color:#ae81ff">10909</span>
</span></span><span style="display:flex;"><span>      - <span style="color:#ae81ff">17911</span>:<span style="color:#ae81ff">17911</span>
</span></span><span style="display:flex;"><span>      - <span style="color:#ae81ff">17912</span>:<span style="color:#ae81ff">10912</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">environment</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">TZ</span>: <span style="color:#ae81ff">Asia/Shanghai</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">NAMESRV_ADDR</span>: <span style="color:#e6db74">&#34;rocketmq-namesv1:9876&#34;</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">JAVA_OPT_EXT</span>: <span style="color:#e6db74">&#34;-server -Xms256M -Xmx256M -Xmn128m&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">volumes</span>:
</span></span><span style="display:flex;"><span>      - <span style="color:#ae81ff">/rocketmq/logs/broker-d-s:/home/rocketmq/logs</span>
</span></span><span style="display:flex;"><span>      - <span style="color:#ae81ff">/rocketmq/config/broker-d-s/broker-d-s.conf:/home/rocketmq/rocketmq-4.8.0/conf/broker.conf</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">command</span>: <span style="color:#ae81ff">sh mqbroker  -c /home/rocketmq/rocketmq-4.8.0/conf/broker.conf autoCreateTopicEnable=true &amp;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">networks</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">rocketmq</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">aliases</span>:
</span></span><span style="display:flex;"><span>          - <span style="color:#ae81ff">broker-d-s</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">rocketmq-console</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">image</span>: <span style="color:#ae81ff">styletang/rocketmq-console-ng</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">container_name</span>: <span style="color:#ae81ff">rocketmq-console</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">ports</span>:
</span></span><span style="display:flex;"><span>      - <span style="color:#ae81ff">8090</span>:<span style="color:#ae81ff">8080</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">environment</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">JAVA_OPTS</span>: -<span style="color:#ae81ff">Drocketmq.namesrv.addr=rocketmq-namesv1:9876;rocketmq-namesv2:9877 -Dcom.rocketmq.sendMessageWithVIPChannel=false</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">networks</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">rocketmq</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">aliases</span>:
</span></span><span style="display:flex;"><span>          - <span style="color:#ae81ff">rocketmq-console</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">networks</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">rocketmq</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">name</span>: <span style="color:#ae81ff">rocketmq</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">driver</span>: <span style="color:#ae81ff">bridge</span>
</span></span></code></pre></div><p>执行 docker-compose 部署</p>
<blockquote>
<p>docker-compose up -d</p>
</blockquote>

                </div>
            <br />
        <div>
                
                <a href="https://test.jobcher.com/posts/database/sql-index/" class="prev">前一页</a>
                
                
                <a href="https://test.jobcher.com/posts/kubernetes/argocd/" class="next">后一页</a>
                
            </div>
        </article>
    </div>

    <nav class="footer-nav">
        <ul>
            
            <li><a href="/posts/about">关于我们</a></li>
            
            <li><a href="/posts">博文合集</a></li>
            
            <li><a href="/">网站首页</a></li>
            
        </ul>
    </nav>
    <footer class="footer">
    <span style="color: aliceblue;">© 2019-2023 by jobcher</span>
</footer>
</body>

</html>