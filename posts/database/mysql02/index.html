<!DOCTYPE html>
<html lang="zh">

<head>
    <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta http-equiv="X-UA-Compatible" content="ie=edge">
<link media="all" rel="stylesheet" href="/css/style.css">

<script src="/js/style.js"></script>
    <title>mysql 笔记（2）</title>
</head>

<body>
    <div class="header-box">
    <img src="https://test.jobcher.com/images/logo.webp" id="logo" alt="logo" class="logo">
    <h1><a href="https://test.jobcher.com">打工人日志</a></h1>
</div>
<nav class="nav">
    <ul>
        
            <li>
                <a href="/">首页</a>
                
            </li>
        
            <li>
                <a href="/posts">文章</a>
                
            </li>
        
            <li>
                <a href="https://nav.jobcher.com/">导航</a>
                
            </li>
        
            <li>
                <a href="/posts/about">关于</a>
                
            </li>
        
    </ul>
</nav>
    <div id="post" class="post">
        <header>
            <h2 class="post-title">mysql 笔记（2）</h2>
            
        </header>
        <article class="article">
                <div class="single-content">
                    <h1 id="mysql-学习笔记2">mysql 学习笔记（2）</h1>
<h2 id="mysql-主从复制">mysql 主从复制</h2>
<p><code>MySQL 主从复制是指数据可以从一个MySQL数据库服务器主节点复制到一个或多个从节点。</code>MySQL 默认采用<code>异步复制</code>方式，这样从节点不用一直访问主服务器来更新自己的数据，数据的更新可以在远程连接上进行，从节点可以复制主数据库中的所有数据库或者特定的数据库，或者特定的表。</p>
<h2 id="mysql-主从复制的主要用途">MySQL 主从复制的主要用途</h2>
<ol>
<li>读写分离</li>
<li>数据实时备份，当系统中某个节点发生故障时，可以方便的故障切换(主从切换)</li>
<li>高可用（HA）</li>
<li>架构扩展</li>
</ol>
<h2 id="mysql-主从复制的原理">MySQL 主从复制的原理</h2>
<p>MySQL 主从复制涉及到三个线程，一个运行在主节点（log dump thread），其余两个(I/O thread, SQL thread)运行在从节点，如下图所示:<br>
<img src="/images/mysql0201.png" alt="mysql0201"></p>
<ol>
<li>
<p>主节点 log dump 线程<br>
当从节点连接主节点时，主节点会为其创建一个 log dump 线程，用于发送和读取 bin-log 的内容。在读取 bin-log 中的操作时，log dump 线程会对主节点上的 bin-log 加锁，当读取完成，在发送给从节点之前，锁会被释放。<code>主节点会为自己的每一个从节点创建一个log dump 线程</code>。</p>
</li>
<li>
<p>从节点 I/O 线程<br>
当从节点上执行<code>start slave</code>命令之后，从节点会创建一个 I/O 线程用来连接主节点，请求主库中更新的 bin-log。I/O 线程接收到主节点的 blog dump 进程发来的更新之后，保存在本地<code>relay-log（中继日志）</code>中。</p>
</li>
<li>
<p>从节点 SQL 线程<br>
SQL 线程负责读取 relay-log 中的内容，解析成具体的操作并执行，最终保证主从数据的一致性。<br>
对于每一个主从连接，都需要这三个进程来完成。当主节点有多个从节点时，主节点会为每一个当前连接的从节点建一个<code>log dump 进程</code>，而每个从节点都有自己的<code>I/O进程，SQL进程</code>。从节点用两个线程将从主库拉取更新和执行分成独立的任务，这样在执行同步数据任务的时候，不会降低读操作的性能。比如，如果从节点没有运行，此时 I/O 进程可以很快从主节点获取更新，尽管 SQL 进程还没有执行。如果在 SQL 进程执行之前从节点服务停止，至少 I/O 进程已经从主节点拉取到了最新的变更并且保存在本地 relay 日志中，当服务再次起来之后，就可以完成数据的同步。<br>
要实施复制，首先<code>必须打开Master 端的binary log（bin-log）功能，否则无法实现。</code></p>
</li>
</ol>

                </div>
            <br />
        <div>
                
                <a href="https://test.jobcher.com/posts/error/pveupdate/" class="prev">前一页</a>
                
                
                <a href="https://test.jobcher.com/posts/diary/pve1/" class="next">后一页</a>
                
            </div>
        </article>
    </div>

    <nav class="footer-nav">
        <ul>
            
            <li><a href="/posts/about">关于我们</a></li>
            
            <li><a href="/posts">博文合集</a></li>
            
            <li><a href="/">网站首页</a></li>
            
        </ul>
    </nav>
    <footer class="footer">
    <span style="color: aliceblue;">© 2019-2023 by jobcher</span>
</footer>
</body>

</html>