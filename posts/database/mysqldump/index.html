<!DOCTYPE html>
<html lang="zh">

<head>
    <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta http-equiv="X-UA-Compatible" content="ie=edge">
<link media="all" rel="stylesheet" href="/css/style.css">

<script src="/js/style.js"></script>



    <title>mysql数据库备份迁移</title>
</head>

<body>
    <div class="header-box">
    <img src="https://test.jobcher.com/images/logo.webp" id="logo" alt="logo" class="logo">
    <h1><a href="https://test.jobcher.com">打工人日志</a></h1>
</div>
<nav class="nav">
    <ul>
        
            <li>
                <a href="/">首页</a>
                
            </li>
        
            <li>
                <a href="/posts">文章</a>
                
            </li>
        
            <li>
                <a href="https://nav.jobcher.com/">导航</a>
                
            </li>
        
            <li>
                <a href="/posts/about">关于</a>
                
            </li>
        
    </ul>
</nav>
    <div id="post" class="post">
        <header>
            <h2 class="post-title">mysql数据库备份迁移</h2>
            
        </header>
        <article class="article">
                <div class="single-content">
                    <h1 id="mysql-数据库备份迁移">mysql 数据库备份迁移</h1>
<p>使用 mydumper 做数据备份迁移</p>
<h2 id="备份数据库">备份数据库</h2>
<ol>
<li>安装</li>
</ol>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span><span style="color:#75715e"># 安装 centos</span>
</span></span><span style="display:flex;"><span>yum install https://github.com/mydumper/mydumper/releases/download/v0.11.5/mydumper-0.11.5-1.el7.x86_64.rpm
</span></span><span style="display:flex;"><span>yum install https://github.com/mydumper/mydumper/releases/download/v0.11.5/mydumper-0.11.5-1.el8.x86_64.rpm
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span><span style="color:#75715e"># 安装 ubuntu</span>
</span></span><span style="display:flex;"><span>apt-get install libatomic1
</span></span><span style="display:flex;"><span>wget https://github.com/mydumper/mydumper/releases/download/v0.11.5/mydumper_0.11.5-1.<span style="color:#66d9ef">$(</span>lsb_release -cs<span style="color:#66d9ef">)</span>_amd64.deb
</span></span><span style="display:flex;"><span>dpkg -i mydumper_0.11.5-1.<span style="color:#66d9ef">$(</span>lsb_release -cs<span style="color:#66d9ef">)</span>_amd64.deb
</span></span></code></pre></div><ol start="2">
<li>备份</li>
</ol>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>nohup mydumper -h <span style="color:#e6db74">&#39;备份数据库&#39;</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>-u <span style="color:#e6db74">&#39;用户名&#39;</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>-p <span style="color:#e6db74">&#39;密码&#39;</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--threads<span style="color:#f92672">=</span><span style="color:#ae81ff">16</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>-B 备份数据库 <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>-v <span style="color:#ae81ff">3</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--outputdir<span style="color:#f92672">=</span>./backup --rows<span style="color:#f92672">=</span><span style="color:#ae81ff">100000</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>-L mydumper-logs.log &amp;
</span></span></code></pre></div><h2 id="迁移数据库">迁移数据库</h2>
<ol>
<li>还原数据</li>
</ol>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>nohup myloader -h <span style="color:#e6db74">&#39;迁移数据库&#39;</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>-u <span style="color:#e6db74">&#39;用户名&#39;</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>-p <span style="color:#e6db74">&#39;密码&#39;</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--directory<span style="color:#f92672">=</span>./backup <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>-s 来源数据库 <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>-B 还原数据库 <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>-t <span style="color:#ae81ff">16</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>-v <span style="color:#ae81ff">3</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>-e 2&gt;myloader-logs.log &amp;
</span></span></code></pre></div><h2 id="mydumpermyloader-参数">mydumper/myloader 参数</h2>
<ol>
<li>mydumper</li>
</ol>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>Usage:
</span></span><span style="display:flex;"><span>  mydumper <span style="color:#f92672">[</span>OPTION...<span style="color:#f92672">]</span> multi-threaded MySQL dumping
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Help Options:
</span></span><span style="display:flex;"><span>  -?, --help                  Show help options
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Application Options:
</span></span><span style="display:flex;"><span>  -B, --database              需要备份的数据库，一个数据库一条命令备份，要不就是备份所有数据库，包括mysql。
</span></span><span style="display:flex;"><span>  -T, --tables-list           需要备份的表，用逗号分隔。
</span></span><span style="display:flex;"><span>  -o, --outputdir             备份文件目录
</span></span><span style="display:flex;"><span>  -s, --statement-size        生成插入语句的字节数，默认1000000，这个参数不能太小，不然会报 Row bigger than statement_size <span style="color:#66d9ef">for</span> tools.t_serverinfo
</span></span><span style="display:flex;"><span>  -r, --rows                  试图用行块来分割表，该参数关闭--chunk-filesize
</span></span><span style="display:flex;"><span>  -F, --chunk-filesize        行块分割表的文件大小，单位是MB
</span></span><span style="display:flex;"><span>  -c, --compress              压缩输出文件
</span></span><span style="display:flex;"><span>  -e, --build-empty-files     即使表没有数据，也产生一个空文件
</span></span><span style="display:flex;"><span>  -x, --regex                 正则表达式匹配，如<span style="color:#e6db74">&#39;db.table&#39;</span>
</span></span><span style="display:flex;"><span>  -i, --ignore-engines        忽略的存储引擎，用逗号分隔
</span></span><span style="display:flex;"><span>  -m, --no-schemas            不导出表结构
</span></span><span style="display:flex;"><span>  -d, --no-data               不导出表数据
</span></span><span style="display:flex;"><span>  -G, --triggers              导出触发器
</span></span><span style="display:flex;"><span>  -E, --events                导出事件
</span></span><span style="display:flex;"><span>  -R, --routines              导出存储过程
</span></span><span style="display:flex;"><span>  -k, --no-locks              不执行共享读锁 警告：这将导致不一致的备份
</span></span><span style="display:flex;"><span>  --less-locking              减到最小的锁在innodb表上.
</span></span><span style="display:flex;"><span>  -l, --long-query-guard      设置长查询时间,默认60秒，超过该时间则会报错：There are queries in PROCESSLIST running longer than 60s, aborting dump
</span></span><span style="display:flex;"><span>  -K, --kill-long-queries kill掉长时间执行的查询，备份报错：Lock wait timeout exceeded; try restarting transaction
</span></span><span style="display:flex;"><span>  -D, --daemon                启用守护进程模式
</span></span><span style="display:flex;"><span>  -I, --snapshot-interval     dump快照间隔时间，默认60s，需要在daemon模式下
</span></span><span style="display:flex;"><span>  -L, --logfile               使用日志文件，默认标准输出到终端
</span></span><span style="display:flex;"><span>  --tz-utc                    备份的时候允许备份Timestamp，这样会导致不同时区的备份还原会出问题，默认关闭，参数：--skip-tz-utc to disable.
</span></span><span style="display:flex;"><span>  --skip-tz-utc
</span></span><span style="display:flex;"><span>  --use-savepoints            使用savepoints来减少采集metadata所造成的锁时间，需要SUPER权限
</span></span><span style="display:flex;"><span>  --success-on-1146           Not increment error count and Warning instead of Critical in <span style="color:#66d9ef">case</span> of table doesn<span style="color:#960050;background-color:#1e0010">&#39;</span>t exist
</span></span><span style="display:flex;"><span>  --lock-all-tables           锁全表，代替FLUSH TABLE WITH READ LOCK
</span></span><span style="display:flex;"><span>  -U, --updated-since         Use Update_time to dump only tables updated in the last U days
</span></span><span style="display:flex;"><span>  --trx-consistency-only      Transactional consistency only
</span></span><span style="display:flex;"><span>  -h, --host                  The host to connect to
</span></span><span style="display:flex;"><span>  -u, --user                  Username with privileges to run the dump
</span></span><span style="display:flex;"><span>  -p, --password              User password
</span></span><span style="display:flex;"><span>  -P, --port                  TCP/IP port to connect to
</span></span><span style="display:flex;"><span>  -S, --socket                UNIX domain socket file to use <span style="color:#66d9ef">for</span> connection
</span></span><span style="display:flex;"><span>  -t, --threads               备份执行的线程数,默认4个线程
</span></span><span style="display:flex;"><span>  -C, --compress-protocol     在mysql连接上使用压缩协议
</span></span><span style="display:flex;"><span>  -V, --version               Show the program version and exit
</span></span><span style="display:flex;"><span>  -v, --verbose               更多输出, 0 <span style="color:#f92672">=</span> silent, 1 <span style="color:#f92672">=</span> errors, 2 <span style="color:#f92672">=</span> warnings, 3 <span style="color:#f92672">=</span> info, default <span style="color:#ae81ff">2</span>
</span></span></code></pre></div><ol start="2">
<li>myloader</li>
</ol>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>Usage:
</span></span><span style="display:flex;"><span>  myloader <span style="color:#f92672">[</span>OPTION...<span style="color:#f92672">]</span> multi-threaded MySQL loader
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Help Options:
</span></span><span style="display:flex;"><span>  -?, --help                        Show help options
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Application Options:
</span></span><span style="display:flex;"><span>  -d, --directory                   备份文件所在的目录
</span></span><span style="display:flex;"><span>  -q, --queries-per-transaction     每个事务的query数量, 默认1000
</span></span><span style="display:flex;"><span>  -o, --overwrite-tables            如果表存在则先删除，使用该参数，需要备份时候要备份表结构，不然还原会找不到表
</span></span><span style="display:flex;"><span>  -B, --database                    指定需要还原的数据库
</span></span><span style="display:flex;"><span>  -s, --source-db                   还原的数据库
</span></span><span style="display:flex;"><span>  -e, --enable-binlog               启用二进制日志恢复数据
</span></span><span style="display:flex;"><span>  -h, --host                        The host to connect to
</span></span><span style="display:flex;"><span>  -u, --user                        Username with privileges to run the dump
</span></span><span style="display:flex;"><span>  -p, --password                    User password
</span></span><span style="display:flex;"><span>  -P, --port                        TCP/IP port to connect to
</span></span><span style="display:flex;"><span>  -S, --socket                      UNIX domain socket file to use <span style="color:#66d9ef">for</span> connection
</span></span><span style="display:flex;"><span>  -t, --threads                     使用的线程数量，默认4
</span></span><span style="display:flex;"><span>  -C, --compress-protocol           连接上使用压缩协议
</span></span><span style="display:flex;"><span>  -V, --version                     Show the program version and exit
</span></span><span style="display:flex;"><span>  -v, --verbose                     更多输出, 0 <span style="color:#f92672">=</span> silent, 1 <span style="color:#f92672">=</span> errors, 2 <span style="color:#f92672">=</span> warnings, 3 <span style="color:#f92672">=</span> info, default <span style="color:#ae81ff">2</span>
</span></span></code></pre></div>
                </div>
            <br />
        <div>
                
                <a href="https://test.jobcher.com/posts/menu/eryngii/" class="prev">前一页</a>
                
                
                <a href="https://test.jobcher.com/posts/web/nginx02/" class="next">后一页</a>
                
            </div>
        </article>
    </div>

    <nav class="footer-nav">
        <ul>
            
            <li><a href="/posts/about">关于我们</a></li>
            
            <li><a href="/posts">博文合集</a></li>
            
            <li><a href="/">网站首页</a></li>
            
        </ul>
    </nav>
    <footer class="footer">
    <span style="color: aliceblue;">© 2019-2023 by jobcher</span>
</footer>
</body>

</html>