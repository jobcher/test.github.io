<!DOCTYPE html>
<html lang="zh">

<head>
    <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta http-equiv="X-UA-Compatible" content="ie=edge">
<link media="all" rel="stylesheet" href="/css/style.css">
    <title>windows-exporter 监控</title>
</head>

<body>
    <div class="header-box">
    <img src="https://test.jobcher.com/images/logo.webp" alt="logo" class="logo">
    <h1><a href="https://test.jobcher.com">打工人日志</a></h1>
</div>
<nav class="nav">
    <ul>
        
            <li>
                <a href="/">首页</a>
                
            </li>
        
            <li>
                <a href="/posts">文章</a>
                
            </li>
        
            <li>
                <a href="https://nav.jobcher.com/">导航</a>
                
            </li>
        
            <li>
                <a href="/posts/about">关于</a>
                
            </li>
        
    </ul>
</nav>
    <div id="post" class="post">
        <header>
            <h2 class="post-title">windows-exporter 监控</h2>
            
        </header>
        <article class="article">
            <h1 id="windows-exporter-监控安装">windows-exporter 监控安装</h1>
<h3 id="windows_exporterhttpsgithubcomprometheus-communitywindows_exporter"><a href="https://github.com/prometheus-community/windows_exporter">windows_exporter</a></h3>
<h3 id="下载安装httpsgithubcomprometheus-communitywindows_exporterreleasesdownloadv0200windows_exporter-0200-amd64msi"><a href="https://github.com/prometheus-community/windows_exporter/releases/download/v0.20.0/windows_exporter-0.20.0-amd64.msi">下载安装</a></h3>
<h2 id="启动">启动</h2>
<p>下载 msi 版本，输入一下命令启动</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>msiexec /i C:<span style="color:#ae81ff">\U</span>sers<span style="color:#ae81ff">\A</span>dministrator<span style="color:#ae81ff">\D</span>ownloads<span style="color:#ae81ff">\w</span>indows_exporter.msi ENABLED_COLLECTORS<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;ad,iis,logon,memory,process,tcp,scheduled_task&#34;</span> TEXTFILE_DIR<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;C:\custom_metrics\&#34;
</span></span></span></code></pre></div><p>卸载</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>msiexec /uninstall C:<span style="color:#ae81ff">\U</span>sers<span style="color:#ae81ff">\A</span>dministrator<span style="color:#ae81ff">\D</span>ownloads<span style="color:#ae81ff">\w</span>indows_exporter.msi
</span></span></code></pre></div><h2 id="添加-prometheus-监控">添加 prometheus 监控</h2>
<p>prometheus.yaml</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yml" data-lang="yml"><span style="display:flex;"><span><span style="color:#75715e"># 新增 windows-exporter</span>
</span></span><span style="display:flex;"><span>- <span style="color:#f92672">job_name</span>: <span style="color:#e6db74">&#34;windows-exporter&#34;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">file_sd_configs</span>:
</span></span><span style="display:flex;"><span>    - <span style="color:#f92672">files</span>:
</span></span><span style="display:flex;"><span>        - <span style="color:#e6db74">&#34;./file_sd/windows-exporter.yaml&#34;</span>
</span></span></code></pre></div><p>./file_sd/windows-exporter.yaml</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yml" data-lang="yml"><span style="display:flex;"><span><span style="color:#75715e"># 新增 windows-exporter</span>
</span></span><span style="display:flex;"><span>- <span style="color:#f92672">targets</span>: [<span style="color:#e6db74">&#34;192.168.0.6:9182&#34;</span>]
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">labels</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">instance</span>: <span style="color:#ae81ff">windows-task</span>
</span></span></code></pre></div><h2 id="添加-alertmanager-告警">添加 alertmanager 告警</h2>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yml" data-lang="yml"><span style="display:flex;"><span><span style="color:#75715e"># 告警信息</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">groups</span>:
</span></span><span style="display:flex;"><span>  - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">sanjiang windows 任务计划程序告警</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">rules</span>:
</span></span><span style="display:flex;"><span>      - <span style="color:#f92672">alert</span>: <span style="color:#ae81ff">windows实例任务告警</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">expr</span>: <span style="color:#ae81ff">windows_scheduled_task_state{state=&#34;disabled&#34;,task=~&#34;/ETL_kettle_tasks/.*&#34;}==1</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">for</span>: <span style="color:#ae81ff">30s</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">labels</span>:
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">severity</span>: <span style="color:#ae81ff">critical</span>
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">target</span>: <span style="color:#e6db74">&#34;{{$labels.job}}&#34;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">annotations</span>:
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">summary</span>: <span style="color:#e6db74">&#34;sanjiang: {{$labels.job}} windows 任务异常&#34;</span>
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">description</span>: <span style="color:#e6db74">&#34;{{$labels.task}} of job {{$labels.job}} 该任务断联已超过1分钟&#34;</span>
</span></span></code></pre></div>
            <br />
            <div>
                
                <a href="https://test.jobcher.com/posts/kubernetes/k8s13/" class="prev">前一页</a>
                
                
                <a href="https://test.jobcher.com/posts/kubernetes/k8s12/" class="next">后一页</a>
                
            </div>
        </article>
    </div>

    <nav class="footer-nav">
        <ul>
            
            <li><a href="/posts/about">关于我们</a></li>
            
            <li><a href="/posts">博文合集</a></li>
            
            <li><a href="/">网站首页</a></li>
            
        </ul>
    </nav>
    <footer class="footer">
    <span style="color: aliceblue;">© 2019-2023 by jobcher</span>
</footer>
</body>

</html>