<!DOCTYPE html>
<html lang="zh">

<head>
    <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta http-equiv="X-UA-Compatible" content="ie=edge">
<link media="all" rel="stylesheet" href="/css/style.css">
    <title>logstash 多管道部署</title>
</head>

<body>
    <div class="header-box">
    <img src="https://test.jobcher.com/images/logo.webp" alt="logo" class="logo">
    <h1><a href="https://test.jobcher.com">打工人日志</a></h1>
</div>
<nav class="nav">
    <ul>
        
            <li>
                <a href="/">首页</a>
                
            </li>
        
            <li>
                <a href="/posts">文章</a>
                
            </li>
        
            <li>
                <a href="https://nav.jobcher.com/">导航</a>
                
            </li>
        
            <li>
                <a href="/posts/about">关于</a>
                
            </li>
        
    </ul>
</nav>
    <div id="post" class="post">
        <header>
            <h2 class="post-title">logstash 多管道部署</h2>
            
        </header>
        <article class="article">
            <h1 id="logstash-多管道部署">logstash 多管道部署</h1>
<p>找到 logstash 目录位置，一般来说在 <code>/etc/logstash</code> 路径下,修改 <code>logstash.yml</code></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#75715e">#增加 日志记录</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">path.logs</span>: <span style="color:#ae81ff">/var/log/logstash</span>
</span></span></code></pre></div><h2 id="增加管道">增加管道</h2>
<p>增加 <code>conf.d</code>目录下 test.conf</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-conf" data-lang="conf"><span style="display:flex;"><span>input {
</span></span><span style="display:flex;"><span>    beats {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">host</span> <span style="color:#f92672">=</span><span style="color:#960050;background-color:#1e0010">&gt;</span> <span style="color:#e6db74">&#34;0.0.0.0&#34;</span>
</span></span><span style="display:flex;"><span>        port <span style="color:#f92672">=</span><span style="color:#960050;background-color:#1e0010">&gt;</span> 23000 <span style="color:#75715e"># 修改端口IP
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    }
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>filter {
</span></span><span style="display:flex;"><span>    mutate{
</span></span><span style="display:flex;"><span>        add_field <span style="color:#f92672">=</span><span style="color:#960050;background-color:#1e0010">&gt;</span> {
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#34;cluster&#34;</span> <span style="color:#f92672">=</span><span style="color:#960050;background-color:#1e0010">&gt;</span> <span style="color:#e6db74">&#34;test&#34;</span> <span style="color:#75715e"># 修改标签
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>            <span style="color:#e6db74">&#34;job&#34;</span> <span style="color:#f92672">=</span><span style="color:#960050;background-color:#1e0010">&gt;</span> <span style="color:#e6db74">&#34;logstash&#34;</span>
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>output {
</span></span><span style="display:flex;"><span>        file {
</span></span><span style="display:flex;"><span>            path <span style="color:#f92672">=</span><span style="color:#960050;background-color:#1e0010">&gt;</span> <span style="color:#e6db74">&#34;/data/路径名称&#34;</span> <span style="color:#75715e"># 路径名称
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>            gzip <span style="color:#f92672">=</span><span style="color:#960050;background-color:#1e0010">&gt;</span> <span style="color:#66d9ef">false</span>  <span style="color:#75715e">#匹配以空格开头的行
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>修改 <code>pipelines.yml</code></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yml" data-lang="yml"><span style="display:flex;"><span>- <span style="color:#f92672">pipeline.id</span>: <span style="color:#ae81ff">名称</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">path.config</span>: <span style="color:#e6db74">&#34;/etc/logstash/conf.d/配置文件.conf&#34;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">queue.type</span>: <span style="color:#ae81ff">persisted</span>
</span></span></code></pre></div><h2 id="启动-logstash-文件">启动 logstash 文件</h2>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>/usr/share/logstash/bin/logstash &amp;
</span></span></code></pre></div>
            <br />
            <div>
                
                <a href="https://test.jobcher.com/posts/diary/linux-disk/" class="prev">前一页</a>
                
                
                <a href="https://test.jobcher.com/posts/kubernetes/k8s9/" class="next">后一页</a>
                
            </div>
        </article>
    </div>

    <nav class="footer-nav">
        <ul>
            
            <li><a href="/posts/about">关于我们</a></li>
            
            <li><a href="/posts">博文合集</a></li>
            
            <li><a href="/">网站首页</a></li>
            
        </ul>
    </nav>
    <footer class="footer">
    <span style="color: aliceblue;">© 2019-2023 by jobcher</span>
</footer>
</body>

</html>