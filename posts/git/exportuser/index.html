<!DOCTYPE html>
<html lang="zh">

<head>
    <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta http-equiv="X-UA-Compatible" content="ie=edge">
<link media="all" rel="stylesheet" href="/css/style.css">
    <title>Gitlab批量导出用户</title>
</head>

<body>
    <div class="header-box">
    <img src="https://test.jobcher.com/images/logo.webp" alt="logo" class="logo">
    <h1><a href="https://test.jobcher.com">打工人日志</a></h1>
</div>
<nav class="nav">
    <ul>
        
            <li>
                <a href="/">首页</a>
                
            </li>
        
            <li>
                <a href="/posts">文章</a>
                
            </li>
        
            <li>
                <a href="https://nav.jobcher.com/">导航</a>
                
            </li>
        
            <li>
                <a href="/posts/about">关于</a>
                
            </li>
        
    </ul>
</nav>
    <div id="post" class="post">
        <header>
            <h2 class="post-title">Gitlab批量导出用户</h2>
            
        </header>
        <article class="article">
                <div class="single-content">
                    <h1 id="gitlab-批量导出用户">Gitlab 批量导出用户</h1>
<p>登陆 Gitlab 服务器进行数据库登陆、数据查询及信息导出操作。</p>
<h2 id="操作步骤">操作步骤</h2>
<ol>
<li>根据配置文件，定位数据库相关信息</li>
</ol>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>cat /var/opt/gitlab/gitlab-rails/etc/database.yml
</span></span></code></pre></div><p><img src="/images/exportuser1.png" alt="exportuser1"></p>
<ol start="2">
<li>查看 Gitlab 对应的系统用户</li>
</ol>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>cat /etc/passwd | grep gitlab
</span></span></code></pre></div><p><img src="/images/exportuser2.png" alt="exportuser2"></p>
<ol start="3">
<li>切换用户 gitlab-psql</li>
</ol>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>su - gitlab-psql
</span></span></code></pre></div><ol start="4">
<li>登陆数据库（-h 指定 host，-d 指定数据库） 使用第 1 步获取的信息</li>
</ol>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>psql -h /var/opt/gitlab/postgresql -d gitlabhq_production
</span></span></code></pre></div><p>(1) 查看帮助信息</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>gitlabhq_production<span style="color:#f92672">=</span><span style="color:#75715e"># \h</span>
</span></span></code></pre></div><p>(2) 查看数据库</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>gitlabhq_production<span style="color:#f92672">=</span><span style="color:#75715e"># \l</span>
</span></span></code></pre></div><p>(3) 查看库中的表（执行命令后，按回车键显示更多表信息）</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>gitlabhq_production<span style="color:#f92672">=</span><span style="color:#75715e"># \dt</span>
</span></span></code></pre></div><p>(4) 通过筛查，可在库中找到 users 表，相关用户信息都记录在表中！</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>gitlabhq_production<span style="color:#f92672">=</span><span style="color:#75715e"># \d users</span>
</span></span></code></pre></div><p>(5) 查看表信息</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>gitlabhq_production<span style="color:#f92672">=</span><span style="color:#75715e"># SELECT * FROM users;</span>
</span></span></code></pre></div><p>(6) 查看 users 表中的 name 字段</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>gitlabhq_production<span style="color:#f92672">=</span><span style="color:#75715e"># SELECT name FROM users;</span>
</span></span></code></pre></div><p>(7)登出数据库</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>gitlabhq_production<span style="color:#f92672">=</span><span style="color:#75715e"># \q</span>
</span></span></code></pre></div><ol start="5">
<li>根据需要提取的信息，确定表 users 中的字段，进行导出操作</li>
</ol>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>echo <span style="color:#e6db74">&#39;select name,username,email,state from users;&#39;</span> |psql -h /var/opt/gitlab/postgresql -d gitlabhq_production &gt; userinfo.txt
</span></span></code></pre></div><p>存储在/var/opt/gitlab/postgresql/userinfo.txt</p>

                </div>
            <br />
        <div>
                
                <a href="https://test.jobcher.com/posts/diary/pve1/" class="prev">前一页</a>
                
                
                <a href="https://test.jobcher.com/posts/kubernetes/harbor/" class="next">后一页</a>
                
            </div>
        </article>
    </div>

    <nav class="footer-nav">
        <ul>
            
            <li><a href="/posts/about">关于我们</a></li>
            
            <li><a href="/posts">博文合集</a></li>
            
            <li><a href="/">网站首页</a></li>
            
        </ul>
    </nav>
    <footer class="footer">
    <span style="color: aliceblue;">© 2019-2023 by jobcher</span>
</footer>
</body>

</html>