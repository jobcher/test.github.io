<!DOCTYPE html>
<html lang="zh">

<head>
    <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta http-equiv="X-UA-Compatible" content="ie=edge">
<link media="all" rel="stylesheet" href="/css/style.css">

<script src="/js/style.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/highlight.min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.8/clipboard.min.js"></script>

    <title>kubernetes ansible自动化部署</title>
</head>

<body>
    <div class="header-box">
    <img src="https://test.jobcher.com/images/logo.webp" id="logo" alt="logo" class="logo">
    <h1><a href="https://test.jobcher.com">打工人日志</a></h1>
</div>
<nav class="nav">
    <ul>
        
            <li>
                <a href="/">首页</a>
                
            </li>
        
            <li>
                <a href="/posts">文章</a>
                
            </li>
        
            <li>
                <a href="https://nav.jobcher.com/">导航</a>
                
            </li>
        
            <li>
                <a href="/posts/about">关于</a>
                
            </li>
        
    </ul>
</nav>
    <div id="post" class="post">
        <header>
            <h2 class="post-title">kubernetes ansible自动化部署</h2>
            
        </header>
        <article class="article">
                <div class="single-content">
                    <h1 id="kubernetes-ansible-自动化部署">kubernetes ansible 自动化部署</h1>
<h2 id="服务器规划">服务器规划</h2>
<table>
<thead>
<tr>
<th style="text-align:left">角色</th>
<th style="text-align:left">IP</th>
<th style="text-align:left">组件</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">k8s-master1</td>
<td style="text-align:left">10.12.12.15</td>
<td style="text-align:left">kube-apiserver kube-controller-manager kube-scheduler etcd</td>
</tr>
<tr>
<td style="text-align:left">k8s-master2</td>
<td style="text-align:left">10.12.12.17</td>
<td style="text-align:left">kube-apiserver kube-controller-manager kube-scheduler etcd</td>
</tr>
<tr>
<td style="text-align:left">k8s-02</td>
<td style="text-align:left">10.12.12.22</td>
<td style="text-align:left">kubelet kube-proxy docker etcd</td>
</tr>
<tr>
<td style="text-align:left">k8s-03</td>
<td style="text-align:left">10.12.12.21</td>
<td style="text-align:left">kubelet kube-proxy docker etcd</td>
</tr>
<tr>
<td style="text-align:left">load Balancer(master)</td>
<td style="text-align:left">10.12.12.15 10.12.12.23(VIP)</td>
<td style="text-align:left">nginx keepalived</td>
</tr>
<tr>
<td style="text-align:left">load Balancer(backup)</td>
<td style="text-align:left">10.12.12.17</td>
<td style="text-align:left">nginx keepalived</td>
</tr>
</tbody>
</table>
<h2 id="系统初始化">系统初始化</h2>
<ol>
<li>关闭 selinux，firewalld</li>
<li>关闭 swap</li>
<li>时间同步</li>
<li>写 hosts</li>
<li>ssh 免密（可选）</li>
</ol>
<h2 id="etcd-集群部署">etcd 集群部署</h2>
<ol>
<li>生成 etcd 证书</li>
<li>部署三个 ETC 集群</li>
<li>查看集群状态</li>
</ol>
<h2 id="部署-masterß">部署 Masterß</h2>
<ol>
<li>生成 apiserver 证书</li>
<li>部署 apiserver、controller-manager 和 scheduler 组件</li>
<li>启动 TLS Bootstrapping</li>
</ol>
<h2 id="部署-node">部署 Node</h2>
<ol>
<li>安装 Docker</li>
<li>部署 Kubelet 和 kube-proxy</li>
<li>在 Master 上运行为新 Node 颁发证书</li>
<li>授权 apiserver 访问 kubelet</li>
</ol>
<h2 id="部署插件准备好镜像">部署插件（准备好镜像）</h2>
<ol>
<li>Flannel</li>
<li>Web UI</li>
<li>CoreDNS</li>
<li>Ingress Controller</li>
</ol>
<h2 id="master-高可用">Master 高可用</h2>
<ol>
<li>增加 Master 节点（与 Master1 一致）</li>
<li>部署 nginx 负载均衡器</li>
<li>Nginx+Keepalived 高可用</li>
<li>修改 Node 连接 VIP</li>
</ol>

                </div>
            <br />
        <div>
                
                <a href="https://test.jobcher.com/posts/kubernetes/openelb/" class="prev">前一页</a>
                
                
                <a href="https://test.jobcher.com/posts/git/git3/" class="next">后一页</a>
                
            </div>
        </article>
    </div>

    <nav class="footer-nav">
        <ul>
            
            <li><a href="/posts/about">关于我们</a></li>
            
            <li><a href="/posts">博文合集</a></li>
            
            <li><a href="/">网站首页</a></li>
            
        </ul>
    </nav>
    <footer class="footer">
    <span style="color: aliceblue;">© 2019-2023 by jobcher</span>
</footer>
</body>

</html>