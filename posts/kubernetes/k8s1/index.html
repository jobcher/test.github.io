<!DOCTYPE html>
<html lang="zh">

<head>
    <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta http-equiv="X-UA-Compatible" content="ie=edge">
<link media="all" rel="stylesheet" href="/css/style.css">

<script src="/js/style.js"></script>
    <title>Kubernetes 实验手册（1）</title>
</head>

<body>
    <div class="header-box">
    <img src="https://test.jobcher.com/images/logo.webp" id="logo" alt="logo" class="logo">
    <h1><a href="https://test.jobcher.com">打工人日志</a></h1>
</div>
<nav class="nav">
    <ul>
        
            <li>
                <a href="/">首页</a>
                
            </li>
        
            <li>
                <a href="/posts">文章</a>
                
            </li>
        
            <li>
                <a href="https://nav.jobcher.com/">导航</a>
                
            </li>
        
            <li>
                <a href="/posts/about">关于</a>
                
            </li>
        
    </ul>
</nav>
    <div id="post" class="post">
        <header>
            <h2 class="post-title">Kubernetes 实验手册（1）</h2>
            
        </header>
        <article class="article">
                <div class="single-content">
                    <h1 id="kubernetes-实验手册1">Kubernetes 实验手册（1）</h1>
<p>通过在 pve 创建 5 台虚拟机：</p>
<table>
<thead>
<tr>
<th style="text-align:left">节点</th>
<th style="text-align:left">IP</th>
<th style="text-align:left">作用</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">node0</td>
<td style="text-align:left">192.168.99.69</td>
<td style="text-align:left">k8s-master01</td>
</tr>
<tr>
<td style="text-align:left">node1</td>
<td style="text-align:left">192.168.99.9</td>
<td style="text-align:left">k8s-master02</td>
</tr>
<tr>
<td style="text-align:left">node2</td>
<td style="text-align:left">192.168.99.53</td>
<td style="text-align:left">k8s-master03</td>
</tr>
<tr>
<td style="text-align:left">node3</td>
<td style="text-align:left">192.168.99.41</td>
<td style="text-align:left">k8s-node01</td>
</tr>
<tr>
<td style="text-align:left">node4</td>
<td style="text-align:left">192.168.99.219</td>
<td style="text-align:left">k8s-node02</td>
</tr>
<tr>
<td style="text-align:left">node5</td>
<td style="text-align:left">192.168.99.42</td>
<td style="text-align:left">k8s-master-lb</td>
</tr>
</tbody>
</table>
<table>
<thead>
<tr>
<th style="text-align:left">配置信息</th>
<th style="text-align:left">备注</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">系统版本</td>
<td style="text-align:left">Ubuntu</td>
</tr>
<tr>
<td style="text-align:left">Docker</td>
<td style="text-align:left">20.10.12</td>
</tr>
<tr>
<td style="text-align:left">pod 网段</td>
<td style="text-align:left">172.168.0.0/12</td>
</tr>
<tr>
<td style="text-align:left">service 网段</td>
<td style="text-align:left">10.96.0.0/12</td>
</tr>
</tbody>
</table>
<p>VIP 不要和内网 IP 重复，VIP 需要和主机在同一个局域网内</p>
<ol>
<li>更新 ansible 连接</li>
</ol>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>ssh-copy-id -i ~/.ssh/id_rsa.pub root@192.168.99.155
</span></span><span style="display:flex;"><span>ssh-copy-id -i ~/.ssh/id_rsa.pub root@192.168.99.199
</span></span><span style="display:flex;"><span>ssh-copy-id -i ~/.ssh/id_rsa.pub root@192.168.99.87
</span></span><span style="display:flex;"><span><span style="color:#75715e">#ssh-copy-id -i ~/.ssh/id_rsa.pub root@192.168.99.41</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#ssh-copy-id -i ~/.ssh/id_rsa.pub root@192.168.99.219</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>vim /etc/hosts
</span></span><span style="display:flex;"><span>192.168.99.155  k8s-master01
</span></span><span style="display:flex;"><span>192.168.99.199  k8s-master02
</span></span><span style="display:flex;"><span>192.168.99.87  k8s-master03
</span></span><span style="display:flex;"><span><span style="color:#75715e">#192.168.99.41   k8s-node01</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#192.168.99.219  k8s-node02</span>
</span></span></code></pre></div><h2 id="基本配置">基本配置</h2>
<ol>
<li>安装基本软件包</li>
</ol>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>apt install wget jq psmisc vim net-tools telnet lvm2 git -y
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 关闭swap分区</span>
</span></span><span style="display:flex;"><span>vim /etc/fstab
</span></span><span style="display:flex;"><span>注释掉swap 内容 并重启
</span></span><span style="display:flex;"><span>reboot
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 时间同步</span>
</span></span><span style="display:flex;"><span>apt install ntpdate -y
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 查看时区</span>
</span></span><span style="display:flex;"><span>timedatectl set-timezone <span style="color:#e6db74">&#39;Asia/Shanghai&#39;</span>
</span></span><span style="display:flex;"><span>timedatectl
</span></span><span style="display:flex;"><span>date
</span></span></code></pre></div><ol start="2">
<li>安装 docker</li>
</ol>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>curl -sSL https://get.daocloud.io/docker | sh
</span></span><span style="display:flex;"><span>systemctl restart docker
</span></span></code></pre></div><ol start="3">
<li>安装 k8s 组件</li>
</ol>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span><span style="color:#75715e"># 更新 apt 包索引并安装使用 Kubernetes</span>
</span></span><span style="display:flex;"><span>sudo apt-get update
</span></span><span style="display:flex;"><span>sudo apt-get install -y apt-transport-https ca-certificates curl
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 下载 Google Cloud 公开签名秘钥：</span>
</span></span><span style="display:flex;"><span>sudo curl -fsSLo /usr/share/keyrings/kubernetes-archive-keyring.gpg https://packages.cloud.google.com/apt/doc/apt-key.gpg
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 添加 Kubernetes apt 仓库</span>
</span></span><span style="display:flex;"><span>echo <span style="color:#e6db74">&#34;deb [signed-by=/usr/share/keyrings/kubernetes-archive-keyring.gpg] https://apt.kubernetes.io/ kubernetes-xenial main&#34;</span> | sudo tee /etc/apt/sources.list.d/kubernetes.list
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 更新 apt 包索引，安装 kubelet、kubeadm 和 kubectl，并锁定其版本：</span>
</span></span><span style="display:flex;"><span>sudo apt-get update
</span></span><span style="display:flex;"><span>sudo apt-get install -y kubelet kubeadm kubectl
</span></span><span style="display:flex;"><span>sudo apt-mark hold kubelet kubeadm kubectl
</span></span></code></pre></div><ol start="4">
<li>安装 keepalived 和 haproxy
所有 Master 节点安装 HAProxy 和 KeepAlived</li>
</ol>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>apt install keepalived haproxy -y
</span></span><span style="display:flex;"><span>cp -rf /etc/haproxy/haproxy.cfg /etc/haproxy/haproxy.cfg.bak
</span></span><span style="display:flex;"><span>rm -rf /etc/haproxy/haproxy.cfg
</span></span><span style="display:flex;"><span>vim /etc/haproxy/haproxy.cfg
</span></span></code></pre></div><p>所有 Master 节点的 HAProxy 配置相同</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>global
</span></span><span style="display:flex;"><span>  maxconn  <span style="color:#ae81ff">2000</span>
</span></span><span style="display:flex;"><span>  ulimit-n  <span style="color:#ae81ff">16384</span>
</span></span><span style="display:flex;"><span>  log  127.0.0.1 local0 err
</span></span><span style="display:flex;"><span>  stats timeout 30s
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>defaults
</span></span><span style="display:flex;"><span>  log global
</span></span><span style="display:flex;"><span>  mode  http
</span></span><span style="display:flex;"><span>  option  httplog
</span></span><span style="display:flex;"><span>  timeout connect <span style="color:#ae81ff">5000</span>
</span></span><span style="display:flex;"><span>  timeout client  <span style="color:#ae81ff">50000</span>
</span></span><span style="display:flex;"><span>  timeout server  <span style="color:#ae81ff">50000</span>
</span></span><span style="display:flex;"><span>  timeout http-request 15s
</span></span><span style="display:flex;"><span>  timeout http-keep-alive 15s
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>frontend monitor-in
</span></span><span style="display:flex;"><span>  bind *:33305
</span></span><span style="display:flex;"><span>  mode http
</span></span><span style="display:flex;"><span>  option httplog
</span></span><span style="display:flex;"><span>  monitor-uri /monitor
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>frontend k8s-master
</span></span><span style="display:flex;"><span>  bind 0.0.0.0:16443
</span></span><span style="display:flex;"><span>  bind 127.0.0.1:16443
</span></span><span style="display:flex;"><span>  mode tcp
</span></span><span style="display:flex;"><span>  option tcplog
</span></span><span style="display:flex;"><span>  tcp-request inspect-delay 5s
</span></span><span style="display:flex;"><span>  default_backend k8s-master
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>backend k8s-master
</span></span><span style="display:flex;"><span>  mode tcp
</span></span><span style="display:flex;"><span>  option tcplog
</span></span><span style="display:flex;"><span>  option tcp-check
</span></span><span style="display:flex;"><span>  balance roundrobin
</span></span><span style="display:flex;"><span>  default-server inter 10s downinter 5s rise <span style="color:#ae81ff">2</span> fall <span style="color:#ae81ff">2</span> slowstart 60s maxconn <span style="color:#ae81ff">250</span> maxqueue <span style="color:#ae81ff">256</span> weight <span style="color:#ae81ff">100</span>
</span></span><span style="display:flex;"><span>  server k8s-master01	192.168.99.155:6443  check
</span></span><span style="display:flex;"><span>  server k8s-master02	192.168.99.199:6443  check
</span></span><span style="display:flex;"><span>  server k8s-master03	192.168.99.87:6443  check
</span></span></code></pre></div><p>所有 Master 节点配置 KeepAlived，配置不一样，注意区分<br>
注意每个节点的 IP 和网卡（interface 参数）
vim /etc/keepalived/keepalived.conf</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-conf" data-lang="conf"><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">!</span> Configuration File for keepalived
</span></span><span style="display:flex;"><span>global_defs {
</span></span><span style="display:flex;"><span>    router_id LVS_DEVEL
</span></span><span style="display:flex;"><span>script_user root
</span></span><span style="display:flex;"><span>    enable_script_security
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>vrrp_script chk_apiserver {
</span></span><span style="display:flex;"><span>    script <span style="color:#e6db74">&#34;/etc/keepalived/check_apiserver.sh&#34;</span>
</span></span><span style="display:flex;"><span>    interval 5
</span></span><span style="display:flex;"><span>    weight -5
</span></span><span style="display:flex;"><span>    fall 2
</span></span><span style="display:flex;"><span>rise 1
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>vrrp_instance VI_1 {
</span></span><span style="display:flex;"><span>    state MASTER
</span></span><span style="display:flex;"><span>    interface ens18 <span style="color:#75715e">#查看网关地址
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    mcast_src_ip <span style="color:#ae81ff">192.168.99.155</span> <span style="color:#75715e">#本机IP
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    virtual_router_id 51
</span></span><span style="display:flex;"><span>    priority 101
</span></span><span style="display:flex;"><span>    advert_int 2
</span></span><span style="display:flex;"><span>    authentication {
</span></span><span style="display:flex;"><span>        auth_type PASS
</span></span><span style="display:flex;"><span>        auth_pass K8SHA_KA_AUTH
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    virtual_ipaddress {
</span></span><span style="display:flex;"><span>        <span style="color:#ae81ff">192.168.99.42</span> <span style="color:#75715e"># vip地址
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    }
</span></span><span style="display:flex;"><span><span style="color:#75715e">#    track_script {
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">#       chk_apiserver
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">#    }
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>}
</span></span></code></pre></div><ol start="5">
<li>配置 KeepAlived 健康检查文件
vim /etc/keepalived/check_apiserver.sh</li>
</ol>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span><span style="color:#75715e">#!/bin/bash
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span>err<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">for</span> k in <span style="color:#66d9ef">$(</span>seq <span style="color:#ae81ff">1</span> 3<span style="color:#66d9ef">)</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">do</span>
</span></span><span style="display:flex;"><span>    check_code<span style="color:#f92672">=</span><span style="color:#66d9ef">$(</span>pgrep haproxy<span style="color:#66d9ef">)</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> <span style="color:#f92672">[[</span> $check_code <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;&#34;</span> <span style="color:#f92672">]]</span>; <span style="color:#66d9ef">then</span>
</span></span><span style="display:flex;"><span>        err<span style="color:#f92672">=</span><span style="color:#66d9ef">$(</span>expr $err + 1<span style="color:#66d9ef">)</span>
</span></span><span style="display:flex;"><span>        sleep <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">continue</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">else</span>
</span></span><span style="display:flex;"><span>        err<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>        break
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">fi</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">done</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">if</span> <span style="color:#f92672">[[</span> $err !<span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;0&#34;</span> <span style="color:#f92672">]]</span>; <span style="color:#66d9ef">then</span>
</span></span><span style="display:flex;"><span>    echo <span style="color:#e6db74">&#34;systemctl stop keepalived&#34;</span>
</span></span><span style="display:flex;"><span>    /usr/bin/systemctl stop keepalived
</span></span><span style="display:flex;"><span>    exit <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">else</span>
</span></span><span style="display:flex;"><span>    exit <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">fi</span>
</span></span></code></pre></div><p>chmod +x /etc/keepalived/check_apiserver.sh</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>systemctl restart haproxy.service
</span></span><span style="display:flex;"><span>systemctl restart keepalived.service
</span></span><span style="display:flex;"><span>apt install kubeadm -y
</span></span></code></pre></div><h2 id="集群初始化">集群初始化</h2>
<p>Master01 节点创建 new.yaml 配置文件如下：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>mkdir -p k8s <span style="color:#f92672">&amp;&amp;</span> cd k8s
</span></span><span style="display:flex;"><span>vim new.yaml
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#f92672">apiVersion</span>: <span style="color:#ae81ff">kubeadm.k8s.io/v1beta2</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">bootstrapTokens</span>:
</span></span><span style="display:flex;"><span>  - <span style="color:#f92672">groups</span>:
</span></span><span style="display:flex;"><span>      - <span style="color:#ae81ff">system:bootstrappers:kubeadm:default-node-token</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">token</span>: <span style="color:#ae81ff">7t2weq.bjbawausm0jaxury</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">ttl</span>: <span style="color:#ae81ff">24h0m0s</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">usages</span>:
</span></span><span style="display:flex;"><span>      - <span style="color:#ae81ff">signing</span>
</span></span><span style="display:flex;"><span>      - <span style="color:#ae81ff">authentication</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">kind</span>: <span style="color:#ae81ff">InitConfiguration</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">localAPIEndpoint</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">advertiseAddress</span>: <span style="color:#ae81ff">192.168.99.155</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">bindPort</span>: <span style="color:#ae81ff">6443</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">nodeRegistration</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">criSocket</span>: <span style="color:#ae81ff">/var/run/dockershim.sock</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">name</span>: <span style="color:#ae81ff">k8s-master01</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">taints</span>:
</span></span><span style="display:flex;"><span>    - <span style="color:#f92672">effect</span>: <span style="color:#ae81ff">NoSchedule</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">key</span>: <span style="color:#ae81ff">node-role.kubernetes.io/master</span>
</span></span><span style="display:flex;"><span>---
</span></span><span style="display:flex;"><span><span style="color:#f92672">apiServer</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">certSANs</span>:
</span></span><span style="display:flex;"><span>    - <span style="color:#ae81ff">192.168.99.42</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">timeoutForControlPlane</span>: <span style="color:#ae81ff">4m0s</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">apiVersion</span>: <span style="color:#ae81ff">kubeadm.k8s.io/v1beta2</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">certificatesDir</span>: <span style="color:#ae81ff">/etc/kubernetes/pki</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">clusterName</span>: <span style="color:#ae81ff">kubernetes</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">controlPlaneEndpoint</span>: <span style="color:#ae81ff">192.168.99.42</span>:<span style="color:#ae81ff">16443</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">controllerManager</span>: {}
</span></span><span style="display:flex;"><span><span style="color:#f92672">dns</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">type</span>: <span style="color:#ae81ff">CoreDNS</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">etcd</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">local</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">dataDir</span>: <span style="color:#ae81ff">/var/lib/etcd</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">imageRepository</span>: <span style="color:#ae81ff">registry.cn-hangzhou.aliyuncs.com/google_containers</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">kind</span>: <span style="color:#ae81ff">ClusterConfiguration</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">kubernetesVersion</span>: <span style="color:#ae81ff">v1.23.1</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">networking</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">dnsDomain</span>: <span style="color:#ae81ff">cluster.local</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">podSubnet</span>: <span style="color:#ae81ff">172.168.0.0</span><span style="color:#ae81ff">/16</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">serviceSubnet</span>: <span style="color:#ae81ff">10.96.0.0</span><span style="color:#ae81ff">/12</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">scheduler</span>: {}
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>kubeadm config images pull --config /root/k8s/new.yaml
</span></span></code></pre></div><p>master01 节点生成初始化,初始化以后会在/etc/kubernetes 目录下生成对应的证书和配置文件，之后其他 Master 节点加入 Master01 即可</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>systemctl enable --now kubelet
</span></span><span style="display:flex;"><span>kubeadm init --config /root/k8s/new.yaml  --upload-certs
</span></span></code></pre></div><p>初始化成功以后，会产生 Token 值，用于其他节点加入时使用，因此要记录下初始化成功生成的 token 值（令牌值）：</p>

                </div>
            <br />
        <div>
                
                <a href="https://test.jobcher.com/posts/error/error1/" class="prev">前一页</a>
                
                
                <a href="https://test.jobcher.com/posts/diary/rocketmq/" class="next">后一页</a>
                
            </div>
        </article>
    </div>

    <nav class="footer-nav">
        <ul>
            
            <li><a href="/posts/about">关于我们</a></li>
            
            <li><a href="/posts">博文合集</a></li>
            
            <li><a href="/">网站首页</a></li>
            
        </ul>
    </nav>
    <footer class="footer">
    <span style="color: aliceblue;">© 2019-2023 by jobcher</span>
</footer>
</body>

</html>