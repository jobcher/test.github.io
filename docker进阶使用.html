<!DOCTYPE html>
<html lang="zh">

<head>
    <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta http-equiv="X-UA-Compatible" content="ie=edge">
<link media="all" rel="stylesheet" href="./css/style.css">
<link media="all" rel="stylesheet" href="./css/search.css">

<script src="./js/style.js"></script>



    <title>docker进阶使用 - 打工人日志</title>
</head>

<body>
    <div class="header-box">
    <img src="https://www.jobcher.com/images/logo.webp" id="logo" alt="logo" class="logo">
    <h1><a href="https://www.jobcher.com">打工人日志</a></h1>
</div>
<nav class="nav">
    <ul>
        
            <li>
                <a href="./">首页</a>
                
            </li>
        
            <li>
                <a href="https://nav.jobcher.com/">导航</a>
                
            </li>
        
            <li>
                <a href="./%E5%85%B3%E4%BA%8E%E6%88%91.html">关于</a>
                
            </li>
        
    </ul>
</nav>
    <div id="post" class="post">
        <header>
            <h2 class="post-title">docker进阶使用</h2>
            
        </header>
        <article class="article">
                <div class="single-content">
                    <h1 id="docker-进阶使用">docker 进阶使用</h1>
<p>dockerfile 和 docker compose 的配置</p>
<h1 id="dockerfile-使用">Dockerfile 使用</h1>
<p>Dockerfile 是一个用来构建镜像的文本文件，文本内容包含了一条条构建镜像所需的指令和说明。</p>
<p>例子：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-dockerfile" data-lang="dockerfile"><span style="display:flex;"><span>    FROM nginx<span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>    RUN echo <span style="color:#e6db74">&#39;这是一个本地构建的nginx镜像&#39;</span> &gt; /usr/share/nginx/html/index.html<span style="color:#960050;background-color:#1e0010">
</span></span></span></code></pre></div><p>保存 Dockerfile 文件并在本地路径执行</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>    docker build -t nginx:v1-test .
</span></span><span style="display:flex;"><span>    docker run -name docker run --name nginx-test -d  -p 8080:80 nginx:v1-test
</span></span></code></pre></div><p>浏览 nginx 页面确认更新内容</p>
<pre><code>curl 127.0.0.1:8080
输出：
这是一个本地构建的nginx镜像
</code></pre>
<h2 id="docker-命令详解">Docker 命令详解</h2>
<h3 id="copy">COPY</h3>
<p>复制指令，从上下文目录中复制文件或者目录到容器里指定路径。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-dockerfile" data-lang="dockerfile"><span style="display:flex;"><span>    COPY <span style="color:#f92672">[</span>--chown<span style="color:#f92672">=</span>&lt;user&gt;:&lt;group&gt;<span style="color:#f92672">]</span> &lt;源路径1&gt;...  &lt;目标路径&gt;<span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>    COPY <span style="color:#f92672">[</span>--chown<span style="color:#f92672">=</span>&lt;user&gt;:&lt;group&gt;<span style="color:#f92672">]</span> <span style="color:#f92672">[</span><span style="color:#e6db74">&#34;&lt;源路径1&gt;&#34;</span>,...  <span style="color:#e6db74">&#34;&lt;目标路径&gt;&#34;</span><span style="color:#f92672">]</span><span style="color:#960050;background-color:#1e0010">
</span></span></span></code></pre></div><p>&lt;源路径&gt;：源文件或者源目录，这里可以是通配符表达式，其通配符规则要满足 Go 的 filepath.Match 规则。例如：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-dockerfile" data-lang="dockerfile"><span style="display:flex;"><span>    COPY hom* /mydir/<span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>    COPY hom?.txt /mydir/<span style="color:#960050;background-color:#1e0010">
</span></span></span></code></pre></div><h3 id="from">FROM</h3>
<p>FROM：定制的镜像都是基于 FROM 的镜像</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-dockerfile" data-lang="dockerfile"><span style="display:flex;"><span>    FROM nginx<span style="color:#960050;background-color:#1e0010">
</span></span></span></code></pre></div><h3 id="run">RUN</h3>
<p>RUN：用于执行后面跟着的命令行命令</p>
<p>shell：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-dockerfile" data-lang="dockerfile"><span style="display:flex;"><span>    RUN &lt;命令行命令&gt;<span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>    <span style="color:#75715e"># &lt;命令行命令&gt; 等同于，在终端操作的 shell 命令。</span><span style="color:#960050;background-color:#1e0010">
</span></span></span></code></pre></div><p>exec：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-dockerfile" data-lang="dockerfile"><span style="display:flex;"><span>    RUN <span style="color:#f92672">[</span><span style="color:#e6db74">&#34;可执行文件&#34;</span>, <span style="color:#e6db74">&#34;参数1&#34;</span>, <span style="color:#e6db74">&#34;参数2&#34;</span><span style="color:#f92672">]</span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>    <span style="color:#75715e"># 例如：</span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>    <span style="color:#75715e"># RUN [&#34;./test.php&#34;, &#34;dev&#34;, &#34;offline&#34;] 等价于 RUN ./test.php dev offline</span><span style="color:#960050;background-color:#1e0010">
</span></span></span></code></pre></div><h3 id="add">ADD</h3>
<p>ADD 指令和 COPY 的使用格类似</p>
<p>ADD 的优点：在执行 &lt;源文件&gt; 为 tar 压缩文件的话，压缩格式为 gzip, bzip2 以及 xz 的情况下，会自动复制并解压到 &lt;目标路径&gt;。</p>
<p>ADD 的缺点：在不解压的前提下，无法复制 tar 压缩文件。会令镜像构建缓存失效，从而可能会令镜像构建变得比较缓慢。具体是否使用，可以根据是否需要自动解压来决定。</p>
<h3 id="cmd">CMD</h3>
<p>类似于 RUN 指令，用于运行程序，但二者运行的时间点不同:</p>
<ol>
<li>CMD 在 docker run 时运行。</li>
<li>RUN 是在 docker build。</li>
</ol>
<p>Dockerfile 中如果存在多个 CMD 指令，仅最后一个生效。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-dockerfile" data-lang="dockerfile"><span style="display:flex;"><span>    CMD &lt;shell 命令&gt;<span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>    CMD <span style="color:#f92672">[</span><span style="color:#e6db74">&#34;&lt;可执行文件或命令&gt;&#34;</span>,<span style="color:#e6db74">&#34;&lt;param1&gt;&#34;</span>,<span style="color:#e6db74">&#34;&lt;param2&gt;&#34;</span>,...<span style="color:#f92672">]</span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>    CMD <span style="color:#f92672">[</span><span style="color:#e6db74">&#34;&lt;param1&gt;&#34;</span>,<span style="color:#e6db74">&#34;&lt;param2&gt;&#34;</span>,...<span style="color:#f92672">]</span>  <span style="color:#75715e"># 该写法是为 ENTRYPOINT 指令指定的程序提供默认参数</span><span style="color:#960050;background-color:#1e0010">
</span></span></span></code></pre></div><h2 id="通过-dockerfile-文件封装-hugo">通过 dockerfile 文件封装 hugo</h2>
<p>dokcerfile 文件</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-dockerfile" data-lang="dockerfile"><span style="display:flex;"><span>    FROM nginx:1.21<span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>    COPY public/ /usr/share/nginx/html<span style="color:#960050;background-color:#1e0010">
</span></span></span></code></pre></div><p>docker.sh 文件</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>    <span style="color:#75715e">#/!bin/bash</span>
</span></span><span style="display:flex;"><span>    echo <span style="color:#e6db74">&#34;删除旧的docker&#34;</span>
</span></span><span style="display:flex;"><span>    docker ps
</span></span><span style="display:flex;"><span>    docker stop nginx-hugo
</span></span><span style="display:flex;"><span>    docker rm nginx-hugo
</span></span><span style="display:flex;"><span>    docker rmi nginx:hugo
</span></span><span style="display:flex;"><span>    echo <span style="color:#e6db74">&#34;生成新的docker&#34;</span>
</span></span><span style="display:flex;"><span>    hugo -t LoveIt -D
</span></span><span style="display:flex;"><span>    docker build -t nginx:hugo .
</span></span><span style="display:flex;"><span>    docker run --name nginx-hugo -d -p 8080:80 nginx:hugo
</span></span><span style="display:flex;"><span>    echo <span style="color:#e6db74">&#34;显示端口&#34;</span>
</span></span><span style="display:flex;"><span>    netstat -lntp
</span></span></code></pre></div><p>执行脚本：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>    sh update.sh
</span></span></code></pre></div>
                </div>
            <br />
        <div>
                
                <a href="https://www.jobcher.com/docker-image%E9%95%9C%E5%83%8F%E4%B8%8A%E4%BC%A0.html" class="prev">前一页</a>
                
                
                <a href="https://www.jobcher.com/kubernetes-k8s-%E7%BB%84%E4%BB%B6.html" class="next">后一页</a>
                
            </div>
        </article>
    </div>

    <nav class="footer-nav">
        <ul>
            
            <li><a href="./%E5%85%B3%E4%BA%8E%E6%88%91.html">关于我们</a></li>
            
            <li><a href="./">网站首页</a></li>
            
            <li><a href=""></a></li>
            
        </ul>
    </nav>
    <footer class="footer">
    <span style="color: aliceblue;">© 2019-2023 by jobcher</span>
</footer>
</body>

</html>